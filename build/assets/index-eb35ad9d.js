import{D as g,O as P,aG as q,aH as Z,aI as ee,aJ as te,aK as ne,a as e,w as m,j as a,m as b,E as T,S as k,T as s,C as j,H as M,aF as ie,R as x}from"./index-5e5270d2.js";import{B as p,H as re,C as le,G as F}from"./ui-beea26bf.js";import{B as C,M as v,C as ce,g as G,i as oe,P as Q,k as ae}from"./index-a9355dc5.js";import{T as r,u as U}from"./index-493a8083.js";import{T as de,a as se,b as z,c as he,d as B,C as ue}from"./client-card-10cbe840.js";import{C as R,a as A,D as h}from"./ui-5f8dfeb8.js";import{S as f,a as O}from"./chunk-O5CRURSQ-17ac6dbe.js";import{c as me,a as ge,r as pe,T as fe,b as Ce}from"./lib-80e37f83.js";function be(){const i=g(null),t=i.map(o=>o?o.clientContacts:[]),l=g(!1),c=P({effect:q});return l.on(c.pending,(o,u)=>u),i.on(c.doneData,(o,u)=>u),{getClientFx:c,$clientPending:l,$client:i,$contacts:t}}function Te(){const i=g([]),t=g(!1),l=P({effect:Z});return t.on(l.pending,(c,o)=>o),i.on(l.doneData,(c,o)=>o),{$clientManagers:i,$clientMangersPending:t,getClientManagersFx:l}}function $e(){const i=g([]),t=g(!1),l=P({effect:ee});return t.on(l.pending,(c,o)=>o),i.on(l.doneData,(c,o)=>o),{$clientSubsidies:i,$clientSubsidiesPending:t,getClientSubsidies:l}}function Pe(){const i=g([]),t=g(!1),l=P({effect:te});return t.on(l.pending,(c,o)=>o),i.on(l.doneData,(c,o)=>o),{$clientContracts:i,$clientContractsPending:t,getClientContractsFx:l}}function we(){const i=g(null),t=g(!1),l=P({effect:ne});return t.on(l.pending,(c,o)=>o),i.on(l.doneData,(c,o)=>o),{getClientLastContractFx:l,$clientLastContract:i,$clientLastContractPending:t}}function xe(i){const{active:t}=i;return t?e(C,{colorScheme:"green",children:"Действительный"}):e(C,{colorScheme:"red",children:"Не действительный"})}function Se(i){const{model:t,...l}=i,[c,o]=m([t.$contacts,t.$clientPending]);return a(f,{...l,children:[c.length!==0&&e(b,{children:c.map((u,n)=>e(ye,{contact:u},n))}),!o&&c.length===0&&e(T,{flexGrow:"1",children:"Нету контактов"}),o&&e(T,{flexGrow:"1",children:e(k,{color:"blue.500"})})]})}function ye(i){const{contact:t,...l}=i;return e(R,{...l,children:e(A,{children:a(f,{children:[e(s,{fontSize:"xl",fontWeight:"medium",children:t.contactName}),e(p,{children:e(xe,{active:t.active})}),e(h,{title:"Номер телефона:",children:t.contactPhone}),e(h,{title:"Почта:",children:t.contactEmail}),e(h,{title:"Было обновлено:",children:t.updateTime}),e(h,{title:"Автор обновления:",children:t.updateAuthor}),e(h,{title:"Позиция автора:",children:t.updateAuthorPosition})]})})})}function Ne(i){const{model:t,...l}=i,[c,o]=m([t.$clientManagers,t.$clientMangersPending]);return a(f,{...l,children:[c.length!==0&&e(b,{children:c.map((u,n)=>e(Me,{manager:u},n))}),!o&&c.length===0&&e(T,{flexGrow:"1",children:"Нет менеджеров"}),o&&e(T,{flexGrow:"1",children:e(k,{color:"blue.500"})})]})}function Me(i){const{manager:t,...l}=i;return e(R,{...l,children:a(A,{children:[e(s,{fontSize:"md",fontWeight:"medium",children:t.name}),e(p,{children:e(C,{colorScheme:"orange",children:t.season})}),e(h,{title:"Позиция:",children:t.position}),e(h,{title:"Директория:",children:t.direction})]})})}function Fe(i){const{contract:t,contractPending:l,...c}=i;return a(R,{...c,children:[t&&e(A,{children:a(f,{children:[a(f,{direction:"row",flexWrap:"wrap",children:[e(C,{colorScheme:"orange",children:t.season}),e(C,{colorScheme:"blue",children:t.status})]}),e(h,{title:"Номер:",children:t.number}),e(h,{title:"Клиент:",children:t.client}),e(h,{title:"Менеджер:",children:t.manager}),e(h,{title:"Сумма:",children:t.sum}),e(h,{title:"Адрес:",children:t.deliveryAddress}),e(h,{title:"Дата начала:",children:t.dateStart}),e(h,{title:"Дата окончания:",children:t.dateEnd})]})}),!l&&!t&&e(T,{flexGrow:"1",children:"Нету последнего контракта"}),l&&e(T,{flexGrow:"1",children:e(k,{color:"blue.500"})})]})}const S={main:0,subsidies:1,contracts:2},J=j(),K=j(),L=g(null),H=me({defaultTab:S.main,tabs:S}),E=v.createMap(),I=be(),$=ce.createClientPlots(),w=G.createLandsToLand({lands:$.$clientPlots.map(X)}),D=ge(),V=Te(),_=we(),y=$e(),Le=r.createTable({data:y.$clientSubsidies,tableGenerateCb:()=>({})}),N=Pe(),He=r.createTable({data:N.$clientContracts,tableGenerateCb:()=>({})}),Ie=P({effect:v.fitBoundsFx,source:{map:E.$map,clientPlots:$.$clientPlots},mapParams:(i,{map:t,clientPlots:l})=>({map:t,positions:oe(X(l))})}),ke=P({effect:v.fitBoundsFx,source:{map:E.$map,clientPlot:w.$land},mapParams:(i,{map:t,clientPlot:l})=>({map:t,positions:(l==null?void 0:l.geometryRings)??[]})});M({clock:J,fn:({clientId:i})=>i,target:L});M({clock:L,filter:i=>i!==null,fn:i=>({clientId:i}),target:[I.getClientFx,V.getClientManagersFx,_.getClientLastContractFx]});const ve=M({clock:[H.$tab,L],source:{tabIndex:H.$tab,clientId:L},filter:i=>i.clientId!==null});ve.watch(({tabIndex:i,clientId:t})=>{t&&(i===S.main&&($.getClientPlotsFx({clientId:t}),D.getClientPointsFx({clientId:t})),i===S.subsidies&&y.getClientSubsidies({clientId:t}),i===S.contracts&&N.getClientContractsFx({clientId:t}))});M({clock:$.$clientPlots,target:Ie});M({clock:w.landClicked,target:ke});pe({clock:K,target:[$.$clientPlots,w.$landId,y.$clientSubsidies,N.$clientContracts]});function X(i){return i.map(t=>({...t,id:t.plotId}))}function Je(){const[i,t]=m([J,K]),[l,c]=m([H.$tab,H.tabChanged]),{clientId:o}=ie();return x.useEffect(()=>(i({clientId:Number(o)}),()=>t()),[i,t,o]),a(p,{children:[e(re,{}),e(le,{maxW:"container.xl",py:"10",children:a(f,{direction:{base:"column",md:"row"},spacing:"2",children:[e(O,{w:{base:"100%",md:"75%"},minH:"0",children:a(de,{index:l,onChange:c,isFitted:!0,shadow:"md",rounded:"md",children:[a(se,{children:[e(z,{children:"Основная"}),e(z,{children:"Субсидий"}),e(z,{children:"Контракты"})]}),a(he,{children:[e(B,{children:e(Be,{})}),e(B,{children:e(Ge,{})}),e(B,{children:e(De,{})})]})]})}),e(O,{w:{base:"100%",md:"25%"},minH:"0",children:a(f,{children:[e(We,{}),a(p,{shadow:"md",rounded:"md",p:"3",children:[e(p,{px:"2",py:"2",children:e(s,{fontSize:"xl",fontWeight:"bold",color:"blue.500",children:"Контакты"})}),e(Se,{model:I,minH:"15rem",maxH:"20rem",overflow:"auto"})]}),a(p,{shadow:"md",rounded:"md",p:"3",children:[e(p,{px:"2",py:"2",children:e(s,{fontSize:"xl",fontWeight:"bold",color:"blue.500",children:"Менеджеры"})}),e(Ne,{model:V,minH:"15rem",maxH:"20rem",overflow:"auto"})]}),a(p,{shadow:"md",rounded:"md",p:"3",children:[e(p,{px:"2",py:"2",children:e(s,{fontSize:"xl",fontWeight:"bold",color:"blue.500",children:"Последний контракт"})}),e(ze,{})]})]})})]})})]})}function We(){const[i,t]=m([I.$client,I.$clientPending]);return e(b,{children:e(ue,{client:i,clientPending:t,minH:"20rem",children:e(b,{})})})}function ze(){const[i,t]=m([_.$clientLastContract,_.$clientLastContractPending]);return e(b,{children:e(Fe,{contract:i,contractPending:t,minH:"10rem"})})}function Be(){const[i,t]=m([D.$clientPoints,D.$clientPointsPending]),[l,c,o]=m([$.$clientPlots,w.$land,$.$clientPlotsPending]),u=x.useMemo(()=>l.reduce((n,d)=>(n.findIndex(Y=>Y.plotCultId===d.plotCultId)===-1&&n.push({plotCultId:d.plotCultId,plotCultName:d.plotCultName}),n),[]),[l]);return t||o?e(T,{flexGrow:"1",minH:"30rem",children:e(k,{colorScheme:"blue"})}):e(p,{position:"relative",children:a(F,{templateColumns:"1fr 300px",children:[a(v.Map,{model:E,style:{height:"100%",borderRadius:"inherit"},containerProps:{height:"max(50vh, 300px)",shadow:"md",borderRadius:"20px"},children:[e(G.Lands,{model:w,children:({land:n,onClick:d})=>e(Q,{positions:n.geometryRings,pathOptions:{color:"blue"},eventHandlers:{click:()=>d(n.id)}})}),e(G.Land,{model:w,children:({land:n})=>e(Q,{positions:n.geometryRings,pathOptions:{color:"black"}})}),i.map((n,d)=>e(ae,{position:n.coordinate,children:e(fe,{sticky:!0,opacity:.8,direction:"bottom",children:a(f,{direction:"row",align:"center",children:[e(s,{fontSize:"sm",fontWeight:"bold",children:"Клиент:"}),e(s,{children:n.name}),e(s,{fontSize:"sm",fontWeight:"bold",children:"Категория:"}),e(s,{children:n.category})]})})},d))]}),a(f,{p:"2",children:[e(f,{direction:"row",flexWrap:"wrap",children:u.map((n,d)=>{const W=Ce[n.plotCultId]??"red";return e(C,{bgColor:W.bgColor,color:W.color,whiteSpace:"pre-wrap",children:n.plotCultName},d)})}),a(F,{templateColumns:"auto 1fr",gap:"1",alignItems:"center",children:[e(s,{fontSize:"md",fontWeight:"medium",children:"Участок:"}),e(s,{fontSize:"sm",children:c?c.plotName:"Не выбран"})]}),a(F,{templateColumns:"auto 1fr",gap:"1",alignItems:"center",children:[e(s,{fontSize:"md",fontWeight:"medium",children:"Культура:"}),e(s,{fontSize:"sm",children:c?c.plotCultName:"Не выбран"})]}),a(F,{templateColumns:"auto 1fr",gap:"1",alignItems:"center",children:[e(s,{fontSize:"md",fontWeight:"medium",children:"Площадь:"}),e(s,{fontSize:"sm",children:c?`${c.plotArea} га`:"Не выбран"})]})]})]})})}function Ge(){const[i,t]=m([y.$clientSubsidies,y.$clientSubsidiesPending]),[l]=m([Le.$tableState]),c=x.useMemo(()=>[{header:()=>e(r.Th,{color:"white",children:"Заявитель"}),cell:({item:n})=>e(r.Td,{children:n.appName})},{header:()=>e(r.Th,{color:"white",children:"Вид деятельности"}),cell:({item:n})=>e(r.Td,{children:n.activity})},{header:()=>e(r.Th,{isNumeric:!0,color:"white",children:"Сумма"}),cell:({item:n})=>e(r.Td,{isNumeric:!0,children:n.sum})},{header:()=>e(r.Th,{color:"white",children:"Единица измерения"}),cell:({item:n})=>e(r.Td,{children:n.unit})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Дата подачи"}),cell:({item:n})=>e(r.Td,{isNumeric:!0,children:n.paymentDate})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Дата оплаты"}),cell:({item:n})=>e(r.Td,{isNumeric:!0,children:n.paymentDate})},{header:()=>e(r.Th,{color:"white",children:"Получатель"}),cell:({item:n})=>e(r.Td,{children:n.providerName})}],[]),{getHeaders:o,getCells:u}=U({data:i,columns:c,tableState:l});return e(r.TableContainer,{borderColor:"lightgray",borderWidth:"1px",borderRadius:"md",boxShadow:"md",overflow:"auto",whiteSpace:"pre-wrap",w:"full",h:"fit-content",children:a(r.Table,{sx:{borderCollapse:"collapse"},overflow:"hidden",position:"relative",borderStyle:"hidden",children:[e(r.THead,{bgColor:"blue.500",children:e(r.Tr,{children:o().map((n,d)=>e(x.Fragment,{children:n},d))})}),e(r.TBody,{columnLength:c.length,empty:{empty:i.length===0},loading:{loading:t},children:u().map((n,d)=>e(r.Tr,{children:e(b,{children:n})},d))})]})})}function De(){const[i,t]=m([N.$clientContracts,N.$clientContractsPending]),[l]=m([He.$tableState]),c=x.useMemo(()=>[{header:()=>e(r.Th,{color:"white",children:"Контракт"}),cell:({item:n})=>e(r.Td,{children:n.name})},{header:()=>e(r.Th,{color:"white",children:"Способ доставки"}),cell:({item:n})=>e(r.Td,{children:n.deliveryMethod})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Сезон"}),cell:({item:n})=>e(r.Td,{isNumeric:!0,children:n.season})},{header:()=>e(r.Th,{color:"white",children:"Статус"}),cell:({item:n})=>e(r.Td,{children:n.status})},{header:()=>e(r.Th,{color:"white",children:"Контрак менеджера"}),cell:({item:n})=>e(r.Td,{children:n.managerContract})},{header:()=>e(r.Th,{color:"white",children:"Основной контракт"}),cell:({item:n})=>e(r.Td,{children:n.mainContract})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Цифры"}),cell:({item:n})=>e(r.Td,{isNumeric:!0,children:n.number})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Сумма"}),cell:({item:n})=>e(r.Td,{isNumeric:!0,children:n.sum})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Дата создания"}),cell:({item:n})=>e(r.Td,{isNumeric:!0,children:n.dateCreate})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Дата начала"}),cell:({item:n})=>e(r.Td,{isNumeric:!0,children:n.dateStart})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Дата окончания"}),cell:({item:n})=>e(r.Td,{isNumeric:!0,children:n.dateEnd})},{header:()=>e(r.Th,{color:"white",children:"Подтверждение"}),cell:({item:n})=>e(r.Td,{textAlign:"center",children:n.success?e(C,{colorScheme:"green",children:"Подтверждено"}):e(C,{colorScheme:"red",children:"Не Подтверждено"})})}],[]),{getHeaders:o,getCells:u}=U({data:i,columns:c,tableState:l});return e(r.TableContainer,{borderColor:"lightgray",borderWidth:"1px",borderRadius:"md",boxShadow:"md",overflowY:"auto",overflowX:"auto",whiteSpace:"pre-wrap",w:"full",maxH:"container.sm",children:a(r.Table,{sx:{borderCollapse:"collapse"},overflow:"hidden",position:"relative",borderStyle:"hidden",children:[e(r.THead,{bgColor:"blue.500",position:"sticky",top:"0",zIndex:"1",children:e(r.Tr,{children:o().map((n,d)=>e(x.Fragment,{children:n},d))})}),e(r.TBody,{columnLength:c.length,empty:{empty:i.length===0},loading:{loading:t},children:u().map((n,d)=>e(r.Tr,{children:e(b,{children:n})},d))})]})})}export{Je as ClientProfilePage};
//# sourceMappingURL=index-eb35ad9d.js.map
