import{D as C,E as y,ac as B,O as G,aU as H,J as g,s as d,R as j,j as s,a as t,aV as J,x as Q,I as w,T as m,aF as A}from"./index-18c8bd2a.js";import{c as K,a as X,b as Y,d as Z,e as ee,f as te,g as ne,V as ie,D as R,T as re,h as oe}from"./model-eff63cbc.js";import{T as ce}from"./index.esm-165c6f21.js";import{D as E}from"./ui-e71e40b7.js";import{E as se}from"./ui-1004c3dd.js";import{M as le}from"./index-087dfa9a.js";import{B as N,C as ae}from"./chunk-SRMZVY4F-416136cf.js";import{S as c}from"./chunk-O5CRURSQ-fd5fbe66.js";import{B as $}from"./chunk-NAA7TEES-3d94f66b.js";import{C as h,a as f}from"./chunk-S432VF2S-ac154153.js";import{M as de,b as me,c as ge,d as pe,e as he}from"./model-6bef017f.js";import{C as D}from"./chunk-LS5YNJYH-572e7ca7.js";import{I as fe}from"./chunk-GYFRIY2Z-1b53d17e.js";import"./chunk-QODHG6BI-4b0ebca2.js";import"./index.esm-8cc49020.js";import"./chunk-G72KV6MB-8d47f37f.js";import"./chunk-LB6CWFOC-afb3a818.js";import"./defineProperty-e36890ef.js";import"./chunk-JSSKUSQH-24716c75.js";const ue=1e3,O=C(),Se=C(),U=C(),V=C(),q=C(),L=C(),P=y(null),v=y([]),I=y([]),x=y([]),S=le.createModals({defaultModalsState:{meetingSurvey:!1}}),M=K(),p=X({defaultSteps:["services","plotInspects","contractComplications","recommends"],defaultStep:"services"}),k=Y(),b=Z(),F=ee(),W=te(),u=ne({timeout:ue}),Ce=B({currentStep:p.$currentStep,plotInspects:b.$meetingPlotInspectsRefs,selectServices:v,selectPlotInspects:I,selectContractComplications:x},({currentStep:e,selectServices:r,plotInspects:n,selectPlotInspects:o,selectContractComplications:l})=>e==="services"&&r.length===0||e==="plotInspects"&&!n.map(i=>{var a;return(a=i[0])==null?void 0:a.categoryId}).every(i=>{const a=o.findIndex(T=>T.categoryId===i)!==-1;return console.log(a),a})?!0:e==="contractComplications"&&l.length===0),Me=M.$meetingsDetailsPending;B(k.$meetingServicesRefsPending,b.$meetingPlotInspectsRefsPending,F.$meetingContractComplicationsRefsPending,W.$meetingRecommendsRefsPending,(...e)=>e.some(r=>!!r));const _=G({effect:H,source:{meetingId:P,selectServices:v,selectPlotInspects:I,selectContractComplications:x},mapParams:(e,{meetingId:r,selectServices:n,selectPlotInspects:o,selectContractComplications:l})=>{if(!r||n.length===0)throw new Error("empty");return{visitId:r,providedServices:n.map(i=>i.id),plotInspects:o.map(i=>({inspectionTypeId:i.categoryId,id:i.id})),contractComplications:l.map(i=>i.id),recommends:[]}}});g({clock:O,fn:({meetingId:e})=>e,target:P});g({clock:P,filter:e=>e!=null,fn:e=>({meetingId:e}),target:M.getMeetingDetailsFx});g({clock:u.timerStopped,target:S.modalOpenClicked.prepend(()=>({modalName:"meetingSurvey"}))});g({clock:S.$modalsState,filter:e=>e.meetingSurvey,target:k.getMeetingServicesRefsFx});g({clock:p.$currentStep,filter:e=>e==="services",target:k.getMeetingServicesRefsFx});v.on(U,(e,{value:r,meetingService:n})=>r?[...e,n]:e.filter(o=>o.id!==n.id));g({clock:p.$currentStep,filter:e=>e==="plotInspects",target:b.getMeetingPlotInspectsRefsFx});I.on(V,(e,{value:r,meetingPlotInspect:n})=>r?[...e,n]:e.filter(o=>o.id!==n.id));g({clock:p.$currentStep,filter:e=>e==="contractComplications",target:F.getMeetingContractComplicationsRefsFx});x.on(q,(e,{value:r,meetingContractComplication:n})=>r?[...e,n]:e.filter(o=>o.id!==n.id));g({clock:p.$currentStep,filter:e=>e==="recommends",target:W.getMeetingRecommendsRefsFx});g({clock:S.$modalsState.map(e=>e.meetingSurvey),filter:e=>!e,target:[u.$timer.reinit,v.reinit,I.reinit,x.reinit]});g({clock:L,target:[_]});g({clock:_.done,source:P,fn:e=>({meetingId:e}),target:[S.modalCloseClicked.prepend(()=>({modalName:"meetingSurvey"})),M.getMeetingDetailsFx]});function $e(){const{search:e}=A();return j.useMemo(()=>new URLSearchParams(e),[e])}function Ae(){const[e,r]=d([O,Se]),[n,o]=d([M.$meetingDetails,Me]),l=$e();return j.useEffect(()=>{const i=l.get("meetingId");return l.get("userId"),e({meetingId:Number(i)}),()=>r()},[]),s(N,{position:"relative",children:[s(ae,{maxW:"container.lg",py:"14",position:"relative",children:[o?t(J,{h:"full"}):s(c,{spacing:"8",children:[t(xe,{}),t(Re,{})]}),n&&!(n!=null&&n.client.statusVisit)&&t(N,{position:"fixed",bottom:"5",right:"5",children:t(Ie,{})})]}),t(ye,{})]})}function ve(){const e=d(u.$timer);return s(c,{direction:"row",align:"center",gap:"2",children:[t(re,{fontSize:"2xl"}),s(m,{fontSize:"md",fontWeight:"bold",children:["Таймер встречи: ",oe(e)]})]})}function Ie(){const[e,r,n]=d([u.$isRunning,u.timerStarted,u.timerStopped]);return t(Q,{children:e?t($,{size:"lg",borderRadius:"3xl",colorScheme:"red",onClick:n,children:t(w,{as:ce})}):t($,{size:"lg",borderRadius:"3xl",colorScheme:"blue",onClick:r,children:t(w,{as:ie})})})}function xe(){const[e]=d([M.$meetingDetails]);return e?t(h,{children:t(f,{children:s(c,{children:[t(ve,{}),t(m,{fontSize:"xl",fontWeight:"bold",children:e==null?void 0:e.client.clientName}),t(R,{}),t(E,{title:"Иин:",children:e==null?void 0:e.client.clientIin}),t(E,{title:"Адрес:",children:e==null?void 0:e.client.address})]})})}):t(se,{children:"Нету данных по встрече"})}function Re(){var r,n,o,l;const[e]=d([M.$meetingDetails]);return!e||!(e!=null&&e.client.statusVisit)?null:s(c,{children:[t(m,{fontSize:"medium",fontWeight:"medium",children:"История встречи"}),t(h,{children:t(f,{children:s(c,{children:[s(c,{children:[t(m,{fontSize:"xl",fontWeight:"medium",children:"Предоставленные услуги"}),t(c,{children:(r=e.providedServices)==null?void 0:r.map((i,a)=>t(h,{children:t(f,{children:i.name})},a))})]}),s(c,{children:[t(m,{fontSize:"xl",fontWeight:"medium",children:"Проблемы по контракту"}),t(c,{children:(n=e.contractComplications)==null?void 0:n.map((i,a)=>t(h,{children:t(f,{children:i.name})},a))})]}),s(c,{children:[t(m,{fontSize:"xl",fontWeight:"medium",children:"Проблемы по контракту"}),t(c,{children:(o=e.plotInspects)==null?void 0:o.map((i,a)=>t(h,{children:t(f,{children:i.name})},a))})]}),s(c,{children:[t(m,{fontSize:"xl",fontWeight:"medium",children:"Проблемы по контракту"}),t(c,{children:(l=e.recommends)==null?void 0:l.map((i,a)=>t(h,{children:t(f,{children:i.name})},a))})]})]})})})]})}function ye(){const[e,r]=d([S.$modalsState,S.modalCloseClicked]),[n,o,l]=d([p.$currentStep,p.setStepNext,p.setStepPrev]),[i]=d([Ce]);return s(de,{isCentered:!0,size:"6xl",isOpen:e.meetingSurvey,onClose:()=>r({modalName:"meetingSurvey"}),scrollBehavior:"inside",children:[t(me,{}),s(ge,{h:"xl",children:[s(pe,{children:[n==="services"&&t(Pe,{}),n==="plotInspects"&&t(ke,{}),n==="contractComplications"&&t(be,{}),n==="recommends"&&t(Te,{})]}),t(he,{children:s(c,{direction:"row",children:[n!=="services"&&t($,{colorScheme:"blue",onClick:l,children:"Назад"}),n!=="recommends"?t($,{colorScheme:"blue",isDisabled:i,onClick:o,children:"Дальше"}):t($,{colorScheme:"red",onClick:()=>L(),children:"Завершить"})]})})]})]})}function Pe(){const[e,r]=d([k.$meetingServicesRefs,v]),[n]=d([U]);return s(c,{children:[t(m,{fontSize:"xl",fontWeight:"bold",children:"Заполните какие услуги были предоставлены?"}),t(R,{}),e.map((o,l)=>s(c,{direction:"row",justify:"space-between",children:[t(m,{children:o.name}),t(D,{size:"lg",isChecked:!!r.find(i=>i.id===o.id),onChange:i=>n({value:i.target.checked,meetingService:o})})]},l))]})}function ke(){const[e,r]=d([b.$meetingPlotInspectsRefs,I]),[n]=d([V]);return s(c,{children:[t(m,{fontSize:"xl",fontWeight:"bold",children:"Заполните отчет по осмотру участка"}),t(R,{}),t(c,{children:e.map((o,l)=>{var i;return s(c,{children:[t(m,{fontSize:"md",fontWeight:"bold",children:(i=o[0])==null?void 0:i.category}),t(R,{}),o.map((a,T)=>s(c,{direction:"row",justify:"space-between",children:[t(m,{children:a.name}),t(D,{size:"lg",isChecked:!!r.find(z=>z.id===a.id),onChange:z=>n({value:z.target.checked,meetingPlotInspect:a})})]},T))]},l)})})]})}function be(){const[e,r]=d([F.$meetingContractComplicationsRefs,x]),[n]=d([q]);return s(c,{children:[t(m,{fontSize:"xl",fontWeight:"bold",children:"Заполните сложности заключения договора"}),e.map((o,l)=>s(c,{direction:"row",justify:"space-between",children:[t(m,{children:o.name}),t(D,{size:"lg",isChecked:!!r.find(i=>i.id===o.id),onChange:i=>n({value:i.target.checked,meetingContractComplication:o})})]},l))]})}function Te(){const[e]=d([W.$meetingRecommendsRefs]);return s(c,{children:[t(m,{fontSize:"md",fontWeight:"bold",children:"Заполните рекомендаций"}),e.map((r,n)=>t(c,{children:t(fe,{placeholder:r.name})},n))]})}export{Ae as MeetingDetailsMobilePage};
//# sourceMappingURL=index-eeb9d110.js.map
