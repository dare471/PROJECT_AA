import{D as m,O as w,b0 as J,b1 as K,b2 as Z,b3 as ee,b4 as te,a4 as ne,j as a,a as e,T as h,E as C,S as N,s as g,x as T,C as Q,H as M,aP as ie,R as x}from"./index-01e3cde2.js";import{H as re}from"./ui-fa408ddb.js";import{B as b,M as E,k as G,l as le,m as ce,P as R,o as oe}from"./client-plots-a373be4b.js";import{T as r,u as O}from"./index-1304a803.js";import{D as d}from"./ui-ff944912.js";import{a as ae,C as de}from"./index-3f009d67.js";import{C as I,a as k}from"./chunk-S432VF2S-c1136581.js";import{S as f,a as A}from"./chunk-O5CRURSQ-427a7ad7.js";import{B as p,C as se}from"./index.esm-6f403ff8.js";import{c as he}from"./model-5251df83.js";import{r as ue,T as me,c as ge}from"./lib-eba40f10.js";import{G as L}from"./index.esm-1434fe2b.js";import{T as pe,a as fe,b as z,c as Ce,d as B}from"./chunk-TPBRUKW6-0adf00db.js";import"./chunk-NAA7TEES-a032545a.js";import"./chunk-PEYICJIL-9b2ee317.js";import"./chunk-LB6CWFOC-afb3a818.js";import"./chunk-G72KV6MB-0b7bd11b.js";function be(){const n=m(null),t=n.map(c=>c?c.clientContacts:[]),l=m(!1),o=w({effect:J});return l.on(o.pending,(c,u)=>u),n.on(o.doneData,(c,u)=>u),{getClientFx:o,$clientPending:l,$client:n,$contacts:t}}function Te(){const n=m([]),t=m(!1),l=w({effect:K});return t.on(l.pending,(o,c)=>c),n.on(l.doneData,(o,c)=>c),{$clientManagers:n,$clientMangersPending:t,getClientManagersFx:l}}function Pe(){const n=m([]),t=m(!1),l=w({effect:Z});return t.on(l.pending,(o,c)=>c),n.on(l.doneData,(o,c)=>c),{$clientSubsidies:n,$clientSubsidiesPending:t,getClientSubsidies:l}}function $e(){const n=m([]),t=m(!1),l=w({effect:ee});return t.on(l.pending,(o,c)=>c),n.on(l.doneData,(o,c)=>c),{$clientContracts:n,$clientContractsPending:t,getClientContractsFx:l}}function xe(){const n=m(null),t=m(!1),l=w({effect:te});return t.on(l.pending,(o,c)=>c),n.on(l.doneData,(o,c)=>c),{getClientLastContractFx:l,$clientLastContract:n,$clientLastContractPending:t}}function we(){const n=m([]),t=m(!1),l=w({effect:ne});return t.on(l.pending,(o,c)=>c),n.on(l.doneData,(o,c)=>c),{getClientPointsFx:l,$clientPoints:n,$clientPointsPending:t}}function Se(n){const{client:t,clientPending:l=!1,children:o,...c}=n;return a(I,{...c,children:[t&&a(k,{children:[o,a(f,{children:[e(h,{fontSize:"xl",fontWeight:"bold",children:t.clientName}),e(p,{children:e(ae,{guid:t.guid})}),e(d,{title:"Бин/Иин:",children:t.clientBin}),e(d,{title:"Адрес:",children:t.clientAddress}),e(d,{title:"Деятельность:",children:t.clientActivity}),e(d,{title:"Като:",children:t.clientCato})]})]}),!l&&!t&&e(C,{flexGrow:"1",children:"Нету данных по клиенту"}),l&&e(C,{flexGrow:"1",children:e(N,{colorScheme:"blue"})})]})}function ye(n){const{active:t}=n;return t?e(b,{colorScheme:"green",children:"Действительный"}):e(b,{colorScheme:"red",children:"Не действительный"})}function Ne(n){const{model:t,...l}=n,[o,c]=g([t.$contacts,t.$clientPending]);return a(f,{...l,children:[o.length!==0&&e(T,{children:o.map((u,i)=>e(Me,{contact:u},i))}),!c&&o.length===0&&e(C,{flexGrow:"1",children:"Нету контактов"}),c&&e(C,{flexGrow:"1",children:e(N,{color:"blue.500"})})]})}function Me(n){const{contact:t,...l}=n;return e(I,{...l,children:e(k,{children:a(f,{children:[e(h,{fontSize:"xl",fontWeight:"medium",children:t.contactName}),e(p,{children:e(ye,{active:t.active})}),e(d,{title:"Номер телефона:",children:t.contactPhone}),e(d,{title:"Почта:",children:t.contactEmail}),e(d,{title:"Было обновлено:",children:t.updateTime}),e(d,{title:"Автор обновления:",children:t.updateAuthor}),e(d,{title:"Позиция автора:",children:t.updateAuthorPosition})]})})})}function Le(n){const{model:t,...l}=n,[o,c]=g([t.$clientManagers,t.$clientMangersPending]);return a(f,{...l,children:[o.length!==0&&e(T,{children:o.map((u,i)=>e(Fe,{manager:u},i))}),!c&&o.length===0&&e(C,{flexGrow:"1",children:"Нет менеджеров"}),c&&e(C,{flexGrow:"1",children:e(N,{color:"blue.500"})})]})}function Fe(n){const{manager:t,...l}=n;return e(I,{...l,children:a(k,{children:[e(h,{fontSize:"md",fontWeight:"medium",children:t.name}),e(p,{children:e(b,{colorScheme:"orange",children:t.season})}),e(d,{title:"Позиция:",children:t.position}),e(d,{title:"Директория:",children:t.direction})]})})}function ve(n){const{contract:t,contractPending:l,...o}=n;return a(I,{...o,children:[t&&e(k,{children:a(f,{children:[a(f,{direction:"row",flexWrap:"wrap",children:[e(b,{colorScheme:"orange",children:t.season}),e(b,{colorScheme:"blue",children:t.status})]}),e(d,{title:"Номер:",children:t.number}),e(d,{title:"Клиент:",children:t.client}),e(d,{title:"Менеджер:",children:t.manager}),e(d,{title:"Сумма:",children:t.sum}),e(d,{title:"Адрес:",children:t.deliveryAddress}),e(d,{title:"Дата начала:",children:t.dateStart}),e(d,{title:"Дата окончания:",children:t.dateEnd})]})}),!l&&!t&&e(C,{flexGrow:"1",children:"Нету последнего контракта"}),l&&e(C,{flexGrow:"1",children:e(N,{color:"blue.500"})})]})}const j=Q(),U=Q(),F=m(null),v=he({defaultTab:"main",tabs:["main","subsidies","contracts"]}),V=E.createMap(),H=be(),P=de.createClientPlots(),$=G.createLandsToLand({lands:P.$clientPlots.map(We)}),_=we(),X=Te(),D=xe(),S=Pe(),He=r.createTable({data:S.$clientSubsidies,tableGenerateCb:()=>({})}),y=$e(),Ie=r.createTable({data:y.$clientContracts,tableGenerateCb:()=>({})}),Y=le({map:V.$map,layer:{clientPlots:P.$clientPlots.map(n=>({positions:ce(n)})),clientPlot:$.$land.map(n=>({positions:(n==null?void 0:n.geometryRings)??[]}))}});M({clock:j,fn:({clientId:n})=>n,target:F});M({clock:F,filter:n=>n!==null,fn:n=>({clientId:n}),target:[H.getClientFx,X.getClientManagersFx,D.getClientLastContractFx]});const ke=M({clock:[v.$tab,F],source:{tab:v.$tab,clientId:F},filter:n=>n.clientId!==null});ke.watch(({tab:n,clientId:t})=>{t&&(n.index===0&&(P.getClientPlotsFx({clientId:t}),_.getClientPointsFx({clientId:t})),n.index===1&&S.getClientSubsidies({clientId:t}),n.index===2&&y.getClientContractsFx({clientId:t}))});M({clock:P.$clientPlots,filter:n=>n.length>0,target:Y.clientPlots});M({clock:$.landClicked,filter:n=>n!==null,target:Y.clientPlot});ue({clock:U,target:[P.$clientPlots,$.$landId,S.$clientSubsidies,y.$clientContracts]});function We(n){return n.map(t=>({...t,id:t.plotId}))}function it(){const[n,t]=g([j,U]),[l,o]=g([v.$tab,v.tabChanged]),{clientId:c}=ie();return x.useEffect(()=>(n({clientId:Number(c)}),()=>t()),[n,t,c]),a(p,{children:[e(re,{}),e(se,{maxW:"container.xl",py:"10",children:a(f,{direction:{base:"column",md:"row"},spacing:"2",children:[e(A,{w:{base:"100%",md:"75%"},minH:"0",children:a(pe,{index:l.index,onChange:o,isFitted:!0,shadow:"md",rounded:"md",children:[a(fe,{children:[e(z,{children:"Основная"}),e(z,{children:"Субсидий"}),e(z,{children:"Контракты"})]}),a(Ce,{children:[e(B,{children:e(Ge,{})}),e(B,{children:e(_e,{})}),e(B,{children:e(De,{})})]})]})}),e(A,{w:{base:"100%",md:"25%"},minH:"0",children:a(f,{children:[e(ze,{}),a(p,{shadow:"md",rounded:"md",p:"3",children:[e(p,{px:"2",py:"2",children:e(h,{fontSize:"xl",fontWeight:"bold",color:"blue.500",children:"Контакты"})}),e(Ne,{model:H,minH:"15rem",maxH:"20rem",overflow:"auto"})]}),a(p,{shadow:"md",rounded:"md",p:"3",children:[e(p,{px:"2",py:"2",children:e(h,{fontSize:"xl",fontWeight:"bold",color:"blue.500",children:"Менеджеры"})}),e(Le,{model:X,minH:"15rem",maxH:"20rem",overflow:"auto"})]}),a(p,{shadow:"md",rounded:"md",p:"3",children:[e(p,{px:"2",py:"2",children:e(h,{fontSize:"xl",fontWeight:"bold",color:"blue.500",children:"Последний контракт"})}),e(Be,{})]})]})})]})})]})}function ze(){const[n,t]=g([H.$client,H.$clientPending]);return e(T,{children:e(Se,{client:n,clientPending:t,minH:"20rem",children:e(T,{})})})}function Be(){const[n,t]=g([D.$clientLastContract,D.$clientLastContractPending]);return e(T,{children:e(ve,{contract:n,contractPending:t,minH:"10rem"})})}function Ge(){const[n,t]=g([_.$clientPoints,_.$clientPointsPending]),[l,o,c]=g([P.$clientPlots,$.$land,P.$clientPlotsPending]),u=x.useMemo(()=>l.reduce((i,s)=>(i.findIndex(q=>q.plotCultId===s.plotCultId)===-1&&i.push({plotCultId:s.plotCultId,plotCultName:s.plotCultName}),i),[]),[l]);return t||c?e(C,{flexGrow:"1",minH:"30rem",children:e(N,{colorScheme:"blue"})}):e(p,{position:"relative",children:a(L,{templateColumns:"1fr 300px",children:[a(E.Map,{model:V,style:{height:"100%",borderRadius:"inherit"},containerProps:{height:"max(50vh, 300px)",shadow:"md",borderRadius:"20px"},children:[e(G.Lands,{model:$,children:({land:i,onClick:s})=>e(R,{positions:i.geometryRings,pathOptions:{color:"blue"},eventHandlers:{click:()=>s(i.id)}})}),e(G.Land,{model:$,children:({land:i})=>e(R,{positions:i.geometryRings,pathOptions:{color:"black"}})}),n.map((i,s)=>e(oe,{position:i.coordinate,children:e(me,{sticky:!0,opacity:.8,direction:"bottom",children:a(f,{direction:"row",align:"center",children:[e(h,{fontSize:"sm",fontWeight:"bold",children:"Клиент:"}),e(h,{children:i.name}),e(h,{fontSize:"sm",fontWeight:"bold",children:"Категория:"}),e(h,{children:i.category})]})})},s))]}),a(f,{p:"2",children:[e(f,{direction:"row",flexWrap:"wrap",children:u.map((i,s)=>{const W=ge[i.plotCultId]??"red";return e(b,{bgColor:W.bgColor,color:W.color,whiteSpace:"pre-wrap",children:i.plotCultName},s)})}),a(L,{templateColumns:"auto 1fr",gap:"1",alignItems:"center",children:[e(h,{fontSize:"md",fontWeight:"medium",children:"Участок:"}),e(h,{fontSize:"sm",children:o?o.plotName:"Не выбран"})]}),a(L,{templateColumns:"auto 1fr",gap:"1",alignItems:"center",children:[e(h,{fontSize:"md",fontWeight:"medium",children:"Культура:"}),e(h,{fontSize:"sm",children:o?o.plotCultName:"Не выбран"})]}),a(L,{templateColumns:"auto 1fr",gap:"1",alignItems:"center",children:[e(h,{fontSize:"md",fontWeight:"medium",children:"Площадь:"}),e(h,{fontSize:"sm",children:o?`${o.plotArea} га`:"Не выбран"})]})]})]})})}function _e(){const[n,t]=g([S.$clientSubsidies,S.$clientSubsidiesPending]),[l]=g([He.$tableState]),o=x.useMemo(()=>[{header:()=>e(r.Th,{color:"white",children:"Заявитель"}),cell:({item:i})=>e(r.Td,{children:i.appName})},{header:()=>e(r.Th,{color:"white",children:"Вид деятельности"}),cell:({item:i})=>e(r.Td,{children:i.activity})},{header:()=>e(r.Th,{isNumeric:!0,color:"white",children:"Сумма"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.sum})},{header:()=>e(r.Th,{color:"white",children:"Единица измерения"}),cell:({item:i})=>e(r.Td,{children:i.unit})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Дата подачи"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.paymentDate})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Дата оплаты"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.paymentDate})},{header:()=>e(r.Th,{color:"white",children:"Получатель"}),cell:({item:i})=>e(r.Td,{children:i.providerName})}],[]),{getHeaders:c,getCells:u}=O({data:n,columns:o,tableState:l});return e(r.TableContainer,{borderColor:"lightgray",borderWidth:"1px",borderRadius:"md",boxShadow:"md",overflow:"auto",whiteSpace:"pre-wrap",w:"full",h:"fit-content",children:a(r.Table,{sx:{borderCollapse:"collapse"},overflow:"hidden",position:"relative",borderStyle:"hidden",children:[e(r.THead,{bgColor:"blue.500",children:e(r.Tr,{children:c().map((i,s)=>e(x.Fragment,{children:i},s))})}),e(r.TBody,{columnLength:o.length,empty:{empty:n.length===0},loading:{loading:t},children:u().map((i,s)=>e(r.Tr,{children:e(T,{children:i})},s))})]})})}function De(){const[n,t]=g([y.$clientContracts,y.$clientContractsPending]),[l]=g([Ie.$tableState]),o=x.useMemo(()=>[{header:()=>e(r.Th,{color:"white",children:"Контракт"}),cell:({item:i})=>e(r.Td,{children:i.name})},{header:()=>e(r.Th,{color:"white",children:"Способ доставки"}),cell:({item:i})=>e(r.Td,{children:i.deliveryMethod})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Сезон"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.season})},{header:()=>e(r.Th,{color:"white",children:"Статус"}),cell:({item:i})=>e(r.Td,{children:i.status})},{header:()=>e(r.Th,{color:"white",children:"Контрак менеджера"}),cell:({item:i})=>e(r.Td,{children:i.managerContract})},{header:()=>e(r.Th,{color:"white",children:"Основной контракт"}),cell:({item:i})=>e(r.Td,{children:i.mainContract})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Цифры"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.number})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Сумма"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.sum})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Дата создания"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.dateCreate})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Дата начала"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.dateStart})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Дата окончания"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.dateEnd})},{header:()=>e(r.Th,{color:"white",children:"Подтверждение"}),cell:({item:i})=>e(r.Td,{textAlign:"center",children:i.success?e(b,{colorScheme:"green",children:"Подтверждено"}):e(b,{colorScheme:"red",children:"Не Подтверждено"})})}],[]),{getHeaders:c,getCells:u}=O({data:n,columns:o,tableState:l});return e(r.TableContainer,{borderColor:"lightgray",borderWidth:"1px",borderRadius:"md",boxShadow:"md",overflowY:"auto",overflowX:"auto",whiteSpace:"pre-wrap",w:"full",maxH:"container.sm",children:a(r.Table,{sx:{borderCollapse:"collapse"},overflow:"hidden",position:"relative",borderStyle:"hidden",children:[e(r.THead,{bgColor:"blue.500",position:"sticky",top:"0",zIndex:"1",children:e(r.Tr,{children:c().map((i,s)=>e(x.Fragment,{children:i},s))})}),e(r.TBody,{columnLength:o.length,empty:{empty:n.length===0},loading:{loading:t},children:u().map((i,s)=>e(r.Tr,{children:e(T,{children:i})},s))})]})})}export{it as ClientProfilePage};
//# sourceMappingURL=index-ce7406b2.js.map
