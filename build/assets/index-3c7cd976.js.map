{"version":3,"file":"index-3c7cd976.js","sources":["../../src/entities/user/model/user-regions.ts","../../src/pages/settings-subscribes-regions/model.ts","../../src/pages/settings-subscribes-regions/page.tsx"],"sourcesContent":["import { attach, createStore } from 'effector'\n\nimport { $$session } from '~src/entities/session'\n\nimport { userApi, type UserRegion } from '~src/shared/api'\n\nexport function createUserSubscribesRegions() {\n\tconst $userRegions = createStore<UserRegion[]>([])\n\tconst $userRegionsPending = createStore<boolean>(false)\n\n\tconst getUserSubscribesRegionsFx = attach({\n\t\teffect: userApi.userSubscribeRegionsQuery,\n\t\tsource: $$session.$session,\n\t\tmapParams: (params: void, session) => {\n\t\t\tif (!session) throw new Error('session is null')\n\t\t\treturn {\n\t\t\t\tuserId: session.id,\n\t\t\t}\n\t\t},\n\t})\n\n\t$userRegionsPending.on(getUserSubscribesRegionsFx.pending, (_, pending) => pending)\n\t$userRegions.on(getUserSubscribesRegionsFx.doneData, (_, subscribeRegions) => subscribeRegions)\n\n\treturn { getUserSubscribesRegionsFx, $userRegions, $userRegionsPending }\n}\n\nexport function createUserUnSubscribesRegions() {\n\tconst $userRegions = createStore<UserRegion[]>([])\n\tconst $userRegionsPending = createStore<boolean>(false)\n\n\tconst getUserUnSubscribesRegionsFx = attach({\n\t\teffect: userApi.userUnSubscribeRegionsQuery,\n\t\tsource: $$session.$session,\n\t\tmapParams: (params: void, session) => {\n\t\t\tif (!session) throw new Error('session is null')\n\t\t\treturn {\n\t\t\t\tuserId: session.id,\n\t\t\t}\n\t\t},\n\t})\n\n\t$userRegionsPending.on(getUserUnSubscribesRegionsFx.pending, (_, pending) => pending)\n\t$userRegions.on(getUserUnSubscribesRegionsFx.doneData, (_, subscribeRegions) => subscribeRegions)\n\n\treturn { getUserUnSubscribesRegionsFx, $userRegions, $userRegionsPending }\n}\n","import { attach, createEvent, sample } from 'effector'\n\nimport { $$session } from '~src/entities/session'\nimport { createUserSubscribesRegions, createUserUnSubscribesRegions } from '~src/entities/user'\n\nimport { type Session } from '~src/shared/api'\n\nexport const settingsSubscribesRegionsPageMounted = createEvent<void>()\nexport const settingsSubscribesRegionsPageUnmounted = createEvent<void>()\n\nexport const regionsSubscribed = createEvent<number>()\nexport const regionsUnSubscribed = createEvent<number>()\n\nexport const $$userSubscribesRegions = createUserSubscribesRegions()\nexport const $$userUnSubscribesRegions = createUserUnSubscribesRegions()\n\nconst getUserSubscribesRegionsFx = attach({\n\teffect: $$userSubscribesRegions.getUserSubscribesRegionsFx,\n\tsource: $$session.$session,\n\tmapParams: (params: void, session) => {\n\t\tif (!session) throw new Error('Session is not defined')\n\t\treturn { userId: session.id }\n\t},\n})\nconst getUserUnSubscribesRegionsFx = attach({\n\teffect: $$userUnSubscribesRegions.getUserUnSubscribesRegionsFx,\n\tsource: $$session.$session,\n\tmapParams: (params: void, session) => {\n\t\tif (!session) throw new Error('Session is not defined')\n\t\treturn { userId: session.id }\n\t},\n})\nconst subscribeRegionsFx = attach({ effect: $$session.subscribesRegionsFx })\nconst unSubscribeRegionsFx = attach({ effect: $$session.unSubscribesRegionsFx })\n\nsample({\n\tclock: settingsSubscribesRegionsPageMounted,\n\tsource: $$session.$session,\n\tfilter: (session: Session | null): session is Session => session !== null,\n\tfn: (session) => ({ userId: session.id }),\n\ttarget: [getUserSubscribesRegionsFx, getUserUnSubscribesRegionsFx],\n})\n\nsample({\n\tclock: regionsSubscribed,\n\tfn: (regionId) => ({ regionIds: [regionId] }),\n\ttarget: subscribeRegionsFx,\n})\n\nsample({\n\tclock: subscribeRegionsFx.done,\n\ttarget: [getUserSubscribesRegionsFx, getUserUnSubscribesRegionsFx],\n})\n\nsample({\n\tclock: regionsUnSubscribed,\n\tfn: (regionId) => ({ regionIds: [regionId] }),\n\ttarget: unSubscribeRegionsFx,\n})\n\nsample({\n\tclock: unSubscribeRegionsFx.done,\n\ttarget: [getUserSubscribesRegionsFx, getUserUnSubscribesRegionsFx],\n})\n","import { AddIcon, DeleteIcon } from '@chakra-ui/icons'\nimport { Button, Card, CardBody, Stack, Text } from '@chakra-ui/react'\nimport { useUnit } from 'effector-react'\nimport React from 'react'\n\nimport { Spin } from '~src/shared/ui'\n\nimport * as model from './model'\n\nexport function SettingsSubscribesRegionsPage() {\n\tconst [handleMount, handleUnmount] = useUnit([\n\t\tmodel.settingsSubscribesRegionsPageMounted,\n\t\tmodel.settingsSubscribesRegionsPageUnmounted,\n\t])\n\n\tReact.useEffect(() => {\n\t\thandleMount()\n\t\treturn () => handleUnmount()\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [])\n\n\treturn (\n\t\t<Stack>\n\t\t\t<Stack minH='md' shadow='md' px='6' py='4'>\n\t\t\t\t<Text fontSize='2xl' fontWeight='bold' mb='2'>\n\t\t\t\t\tПодписанные регионы\n\t\t\t\t</Text>\n\t\t\t\t<SubscribesRegions />\n\t\t\t</Stack>\n\t\t\t<Stack minH='md' shadow='md' px='6' py='4'>\n\t\t\t\t<Text fontSize='2xl' fontWeight='bold' mb='2'>\n\t\t\t\t\tОтписанные регионы\n\t\t\t\t</Text>\n\t\t\t\t<UnSubscribesRegions />\n\t\t\t</Stack>\n\t\t</Stack>\n\t)\n}\n\nfunction SubscribesRegions() {\n\tconst [subscribesRegions, subscribesRegionsPending] = useUnit([\n\t\tmodel.$$userSubscribesRegions.$userRegions,\n\t\tmodel.$$userSubscribesRegions.$userRegionsPending,\n\t])\n\tconst [handleUnSubscribe] = useUnit([model.regionsUnSubscribed])\n\n\tif (subscribesRegionsPending) {\n\t\treturn <Spin />\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t{subscribesRegions.map((subscribesRegion, index) => (\n\t\t\t\t<Card key={index} variant='filled'>\n\t\t\t\t\t<CardBody>\n\t\t\t\t\t\t<Stack direction='row' justify='space-between' align='center'>\n\t\t\t\t\t\t\t<Text fontSize='md' fontWeight='bold'>\n\t\t\t\t\t\t\t\t{subscribesRegion.name}\n\t\t\t\t\t\t\t</Text>\n\t\t\t\t\t\t\t<Button colorScheme='red' onClick={() => handleUnSubscribe(subscribesRegion.regionId)}>\n\t\t\t\t\t\t\t\t<DeleteIcon />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</Stack>\n\t\t\t\t\t</CardBody>\n\t\t\t\t</Card>\n\t\t\t))}\n\t\t</>\n\t)\n}\n\nfunction UnSubscribesRegions() {\n\tconst [unSubscribesRegions, unSubscribesRegionsPending] = useUnit([\n\t\tmodel.$$userUnSubscribesRegions.$userRegions,\n\t\tmodel.$$userUnSubscribesRegions.$userRegionsPending,\n\t])\n\tconst [handleSubscribe] = useUnit([model.regionsSubscribed])\n\n\tif (unSubscribesRegionsPending) {\n\t\treturn <Spin />\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t{unSubscribesRegions.map((unSubscribesRegion, index) => (\n\t\t\t\t<Card key={index} variant='filled'>\n\t\t\t\t\t<CardBody>\n\t\t\t\t\t\t<Stack direction='row' justify='space-between' align='center'>\n\t\t\t\t\t\t\t<Text fontSize='md' fontWeight='bold'>\n\t\t\t\t\t\t\t\t{unSubscribesRegion.name}\n\t\t\t\t\t\t\t</Text>\n\t\t\t\t\t\t\t<Button colorScheme='blue' onClick={() => handleSubscribe(unSubscribesRegion.regionId)}>\n\t\t\t\t\t\t\t\t<AddIcon />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</Stack>\n\t\t\t\t\t</CardBody>\n\t\t\t\t</Card>\n\t\t\t))}\n\t\t</>\n\t)\n}\n"],"names":["createUserSubscribesRegions","$userRegions","createStore","$userRegionsPending","getUserSubscribesRegionsFx","attach","userApi.userSubscribeRegionsQuery","$$session.$session","params","session","_","pending","subscribeRegions","createUserUnSubscribesRegions","getUserUnSubscribesRegionsFx","userApi.userUnSubscribeRegionsQuery","settingsSubscribesRegionsPageMounted","createEvent","settingsSubscribesRegionsPageUnmounted","regionsSubscribed","regionsUnSubscribed","$$userSubscribesRegions","$$userUnSubscribesRegions","subscribeRegionsFx","$$session.subscribesRegionsFx","unSubscribeRegionsFx","$$session.unSubscribesRegionsFx","sample","regionId","SettingsSubscribesRegionsPage","handleMount","handleUnmount","useUnit","model.settingsSubscribesRegionsPageMounted","model.settingsSubscribesRegionsPageUnmounted","React","Stack","jsxs","jsx","Text","SubscribesRegions","UnSubscribesRegions","subscribesRegions","subscribesRegionsPending","model.$$userSubscribesRegions","handleUnSubscribe","model.regionsUnSubscribed","Spin","subscribesRegion","index","Card","CardBody","Button","DeleteIcon","unSubscribesRegions","unSubscribesRegionsPending","model.$$userUnSubscribesRegions","handleSubscribe","model.regionsSubscribed","unSubscribesRegion","AddIcon"],"mappings":"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"}