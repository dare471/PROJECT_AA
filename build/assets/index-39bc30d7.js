import{D as C,E as P,ac as B,O as G,aU as J,J as g,s as d,aP as q,R as A,j as s,a as t,aV as K,x as L,I as w,T as m}from"./index-3984b6ad.js";import{c as Q,a as X,b as Y,d as Z,e as ee,f as te,g as ne,V as ie,D as R,T as re,h as oe}from"./model-028c13b0.js";import{T as ce}from"./index.esm-96527209.js";import{H as se}from"./ui-0b9c2832.js";import{D as E}from"./ui-07046276.js";import{E as le}from"./ui-3be8c0ee.js";import{M as ae}from"./index-b906b83f.js";import{S as c}from"./chunk-O5CRURSQ-1491cac4.js";import{B as N,C as de}from"./chunk-SRMZVY4F-29920deb.js";import{B as $}from"./chunk-NAA7TEES-d1065a5b.js";import{C as h,a as f}from"./chunk-S432VF2S-0bb7f0e6.js";import{M as me,b as ge,c as pe,d as he,e as fe}from"./model-5b53deea.js";import{C as D}from"./chunk-LS5YNJYH-ec74683b.js";import{I as ue}from"./chunk-GYFRIY2Z-c0e457b7.js";import"./chunk-QODHG6BI-a3dc6b43.js";import"./index.esm-84f69968.js";import"./index.esm-02f9f4e4.js";import"./chunk-G72KV6MB-8fe2283c.js";import"./chunk-D5UZ3RNN-15f388b3.js";import"./chunk-PEYICJIL-361d4c84.js";import"./chunk-LB6CWFOC-afb3a818.js";import"./defineProperty-e36890ef.js";import"./chunk-JSSKUSQH-11f3c90e.js";const Se=1e3,j=C(),Ce=C(),O=C(),V=C(),U=C(),H=C(),y=P(null),v=P([]),x=P([]),I=P([]),S=ae.createModals({defaultModalsState:{meetingSurvey:!1}}),M=Q(),p=X({defaultSteps:["services","plotInspects","contractComplications","recommends"],defaultStep:"services"}),k=Y(),T=Z(),W=ee(),F=te(),u=ne({timeout:Se}),Me=B({currentStep:p.$currentStep,plotInspects:T.$meetingPlotInspectsRefs,selectServices:v,selectPlotInspects:x,selectContractComplications:I},({currentStep:e,selectServices:r,plotInspects:n,selectPlotInspects:o,selectContractComplications:a})=>e==="services"&&r.length===0||e==="plotInspects"&&!n.map(i=>{var l;return(l=i[0])==null?void 0:l.categoryId}).every(i=>{const l=o.findIndex(b=>b.categoryId===i)!==-1;return console.log(l),l})?!0:e==="contractComplications"&&a.length===0),$e=M.$meetingsDetailsPending;B(k.$meetingServicesRefsPending,T.$meetingPlotInspectsRefsPending,W.$meetingContractComplicationsRefsPending,F.$meetingRecommendsRefsPending,(...e)=>e.some(r=>!!r));const _=G({effect:J,source:{meetingId:y,selectServices:v,selectPlotInspects:x,selectContractComplications:I},mapParams:(e,{meetingId:r,selectServices:n,selectPlotInspects:o,selectContractComplications:a})=>{if(!r||n.length===0)throw new Error("empty");return{visitId:r,providedServices:n.map(i=>i.id),plotInspects:o.map(i=>({inspectionTypeId:i.categoryId,id:i.id})),contractComplications:a.map(i=>i.id),recommends:[]}}});g({clock:j,fn:({meetingId:e})=>e,target:y});g({clock:y,filter:e=>e!=null,fn:e=>({meetingId:e}),target:M.getMeetingDetailsFx});g({clock:u.timerStopped,target:S.modalOpenClicked.prepend(()=>({modalName:"meetingSurvey"}))});g({clock:S.$modalsState,filter:e=>e.meetingSurvey,target:k.getMeetingServicesRefsFx});g({clock:p.$currentStep,filter:e=>e==="services",target:k.getMeetingServicesRefsFx});v.on(O,(e,{value:r,meetingService:n})=>r?[...e,n]:e.filter(o=>o.id!==n.id));g({clock:p.$currentStep,filter:e=>e==="plotInspects",target:T.getMeetingPlotInspectsRefsFx});x.on(V,(e,{value:r,meetingPlotInspect:n})=>r?[...e,n]:e.filter(o=>o.id!==n.id));g({clock:p.$currentStep,filter:e=>e==="contractComplications",target:W.getMeetingContractComplicationsRefsFx});I.on(U,(e,{value:r,meetingContractComplication:n})=>r?[...e,n]:e.filter(o=>o.id!==n.id));g({clock:p.$currentStep,filter:e=>e==="recommends",target:F.getMeetingRecommendsRefsFx});g({clock:S.$modalsState.map(e=>e.meetingSurvey),filter:e=>!e,target:[u.$timer.reinit,v.reinit,x.reinit,I.reinit]});g({clock:H,target:[_]});g({clock:_.done,source:y,fn:e=>({meetingId:e}),target:[S.modalCloseClicked.prepend(()=>({modalName:"meetingSurvey"})),M.getMeetingDetailsFx]});function Ze(){const[e,r]=d([j,Ce]),[n,o]=d([M.$meetingDetails,$e]),{meetingId:a}=q();return console.log(n),A.useEffect(()=>(e({meetingId:Number(a)}),()=>r()),[]),s(N,{position:"relative",children:[t(se,{}),s(de,{maxW:"container.lg",py:"14",position:"relative",children:[o?t(K,{h:"full"}):s(c,{spacing:"8",children:[t(Ie,{}),t(Re,{})]}),n&&!(n!=null&&n.client.statusVisit)&&t(N,{position:"fixed",bottom:"5",right:"5",children:t(xe,{})})]}),t(Pe,{})]})}function ve(){const e=d(u.$timer);return s(c,{direction:"row",align:"center",gap:"2",children:[t(re,{fontSize:"2xl"}),s(m,{fontSize:"md",fontWeight:"bold",children:["Таймер встречи: ",oe(e)]})]})}function xe(){const[e,r,n]=d([u.$isRunning,u.timerStarted,u.timerStopped]);return t(L,{children:e?t($,{size:"lg",borderRadius:"3xl",colorScheme:"red",onClick:n,children:t(w,{as:ce})}):t($,{size:"lg",borderRadius:"3xl",colorScheme:"blue",onClick:r,children:t(w,{as:ie})})})}function Ie(){const[e]=d([M.$meetingDetails]);return e?t(h,{children:t(f,{children:s(c,{children:[t(ve,{}),t(m,{fontSize:"xl",fontWeight:"bold",children:e==null?void 0:e.client.clientName}),t(R,{}),t(E,{title:"Иин:",children:e==null?void 0:e.client.clientIin}),t(E,{title:"Адрес:",children:e==null?void 0:e.client.address})]})})}):t(le,{children:"Нету данных по встрече"})}function Re(){var r,n,o,a;const[e]=d([M.$meetingDetails]);return!e||!(e!=null&&e.client.statusVisit)?null:s(c,{children:[t(m,{fontSize:"medium",fontWeight:"medium",children:"История встречи"}),t(h,{children:t(f,{children:s(c,{children:[s(c,{children:[t(m,{fontSize:"xl",fontWeight:"medium",children:"Предоставленные услуги"}),t(c,{children:(r=e.providedServices)==null?void 0:r.map((i,l)=>t(h,{children:t(f,{children:i.name})},l))})]}),s(c,{children:[t(m,{fontSize:"xl",fontWeight:"medium",children:"Проблемы по контракту"}),t(c,{children:(n=e.contractComplications)==null?void 0:n.map((i,l)=>t(h,{children:t(f,{children:i.name})},l))})]}),s(c,{children:[t(m,{fontSize:"xl",fontWeight:"medium",children:"Проблемы по контракту"}),t(c,{children:(o=e.plotInspects)==null?void 0:o.map((i,l)=>t(h,{children:t(f,{children:i.name})},l))})]}),s(c,{children:[t(m,{fontSize:"xl",fontWeight:"medium",children:"Проблемы по контракту"}),t(c,{children:(a=e.recommends)==null?void 0:a.map((i,l)=>t(h,{children:t(f,{children:i.name})},l))})]})]})})})]})}function Pe(){const[e,r]=d([S.$modalsState,S.modalCloseClicked]),[n,o,a]=d([p.$currentStep,p.setStepNext,p.setStepPrev]),[i]=d([Me]);return s(me,{isCentered:!0,size:"6xl",isOpen:e.meetingSurvey,onClose:()=>r({modalName:"meetingSurvey"}),scrollBehavior:"inside",children:[t(ge,{}),s(pe,{h:"xl",children:[s(he,{children:[n==="services"&&t(ye,{}),n==="plotInspects"&&t(ke,{}),n==="contractComplications"&&t(Te,{}),n==="recommends"&&t(be,{})]}),t(fe,{children:s(c,{direction:"row",children:[n!=="services"&&t($,{colorScheme:"blue",onClick:a,children:"Назад"}),n!=="recommends"?t($,{colorScheme:"blue",isDisabled:i,onClick:o,children:"Дальше"}):t($,{colorScheme:"red",onClick:()=>H(),children:"Завершить"})]})})]})]})}function ye(){const[e,r]=d([k.$meetingServicesRefs,v]),[n]=d([O]);return s(c,{children:[t(m,{fontSize:"xl",fontWeight:"bold",children:"Заполните какие услуги были предоставлены?"}),t(R,{}),e.map((o,a)=>s(c,{direction:"row",justify:"space-between",children:[t(m,{children:o.name}),t(D,{size:"lg",isChecked:!!r.find(i=>i.id===o.id),onChange:i=>n({value:i.target.checked,meetingService:o})})]},a))]})}function ke(){const[e,r]=d([T.$meetingPlotInspectsRefs,x]),[n]=d([V]);return s(c,{children:[t(m,{fontSize:"xl",fontWeight:"bold",children:"Заполните отчет по осмотру участка"}),t(R,{}),t(c,{children:e.map((o,a)=>{var i;return s(c,{children:[t(m,{fontSize:"md",fontWeight:"bold",children:(i=o[0])==null?void 0:i.category}),t(R,{}),o.map((l,b)=>s(c,{direction:"row",justify:"space-between",children:[t(m,{children:l.name}),t(D,{size:"lg",isChecked:!!r.find(z=>z.id===l.id),onChange:z=>n({value:z.target.checked,meetingPlotInspect:l})})]},b))]},a)})})]})}function Te(){const[e,r]=d([W.$meetingContractComplicationsRefs,I]),[n]=d([U]);return s(c,{children:[t(m,{fontSize:"xl",fontWeight:"bold",children:"Заполните сложности заключения договора"}),e.map((o,a)=>s(c,{direction:"row",justify:"space-between",children:[t(m,{children:o.name}),t(D,{size:"lg",isChecked:!!r.find(i=>i.id===o.id),onChange:i=>n({value:i.target.checked,meetingContractComplication:o})})]},a))]})}function be(){const[e]=d([F.$meetingRecommendsRefs]);return s(c,{children:[t(m,{fontSize:"md",fontWeight:"bold",children:"Заполните рекомендаций"}),e.map((r,n)=>t(c,{children:t(ue,{placeholder:r.name})},n))]})}export{Ze as MeetingDetailsPage};
//# sourceMappingURL=index-39bc30d7.js.map
