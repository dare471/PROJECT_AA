import{E as u,O as w,b3 as q,b4 as K,b5 as Z,b6 as ee,b7 as te,a4 as ne,j as a,a as e,T as h,H as C,S as N,s as g,x as T,D as Q,J as M,aP as ie,R as x}from"./index-18c8bd2a.js";import{H as re}from"./ui-0f4b7ddc.js";import{B as b,M as E,L as G,f as le,g as ce,P as R}from"./client-plots-cd9a3b47.js";import{T as r}from"./index-f98d9cb8.js";import{D as d}from"./ui-e71e40b7.js";import{a as oe,C as ae}from"./index-88561051.js";import{C as I,a as W}from"./chunk-S432VF2S-ac154153.js";import{S as f,a as A}from"./chunk-O5CRURSQ-fd5fbe66.js";import{B as p,C as de}from"./chunk-SRMZVY4F-416136cf.js";import{c as se}from"./model-cea03ee5.js";import{r as he,T as me,c as ue}from"./lib-29011174.js";import{G as L}from"./index.esm-16d287ff.js";import{T as ge,a as pe,b as z,c as fe,d as B}from"./chunk-TPBRUKW6-11a3249e.js";import{M as Ce}from"./Marker-d66def3f.js";import{u as O}from"./use-table-6c8b6322.js";import"./index.esm-8cc49020.js";import"./chunk-G72KV6MB-8d47f37f.js";import"./chunk-D5UZ3RNN-1523169b.js";import"./chunk-NAA7TEES-3d94f66b.js";import"./chunk-PEYICJIL-0612eafd.js";import"./chunk-LB6CWFOC-afb3a818.js";import"./leaflet-9b10b136.js";function be(){const n=u(null),t=n.map(c=>c?c.clientContacts:[]),l=u(!1),o=w({effect:q});return l.on(o.pending,(c,m)=>m),n.on(o.doneData,(c,m)=>m),{getClientFx:o,$clientPending:l,$client:n,$contacts:t}}function Te(){const n=u([]),t=u(!1),l=w({effect:K});return t.on(l.pending,(o,c)=>c),n.on(l.doneData,(o,c)=>c),{$clientManagers:n,$clientMangersPending:t,getClientManagersFx:l}}function Pe(){const n=u([]),t=u(!1),l=w({effect:Z});return t.on(l.pending,(o,c)=>c),n.on(l.doneData,(o,c)=>c),{$clientSubsidies:n,$clientSubsidiesPending:t,getClientSubsidies:l}}function $e(){const n=u([]),t=u(!1),l=w({effect:ee});return t.on(l.pending,(o,c)=>c),n.on(l.doneData,(o,c)=>c),{$clientContracts:n,$clientContractsPending:t,getClientContractsFx:l}}function xe(){const n=u(null),t=u(!1),l=w({effect:te});return t.on(l.pending,(o,c)=>c),n.on(l.doneData,(o,c)=>c),{getClientLastContractFx:l,$clientLastContract:n,$clientLastContractPending:t}}function we(){const n=u([]),t=u(!1),l=w({effect:ne});return t.on(l.pending,(o,c)=>c),n.on(l.doneData,(o,c)=>c),{getClientPointsFx:l,$clientPoints:n,$clientPointsPending:t}}function Se(n){const{client:t,clientPending:l=!1,children:o,...c}=n;return a(I,{...c,children:[t&&a(W,{children:[o,a(f,{children:[e(h,{fontSize:"xl",fontWeight:"bold",children:t.clientName}),e(p,{children:e(oe,{guid:t.guid})}),e(d,{title:"Бин/Иин:",children:t.clientBin}),e(d,{title:"Адрес:",children:t.clientAddress}),e(d,{title:"Деятельность:",children:t.clientActivity}),e(d,{title:"Като:",children:t.clientCato})]})]}),!l&&!t&&e(C,{flexGrow:"1",children:"Нету данных по клиенту"}),l&&e(C,{flexGrow:"1",children:e(N,{colorScheme:"blue"})})]})}function ye(n){const{active:t}=n;return t?e(b,{colorScheme:"green",children:"Действительный"}):e(b,{colorScheme:"red",children:"Не действительный"})}function Ne(n){const{model:t,...l}=n,[o,c]=g([t.$contacts,t.$clientPending]);return a(f,{...l,children:[o.length!==0&&e(T,{children:o.map((m,i)=>e(Me,{contact:m},i))}),!c&&o.length===0&&e(C,{flexGrow:"1",children:"Нету контактов"}),c&&e(C,{flexGrow:"1",children:e(N,{color:"blue.500"})})]})}function Me(n){const{contact:t,...l}=n;return e(I,{...l,children:e(W,{children:a(f,{children:[e(h,{fontSize:"xl",fontWeight:"medium",children:t.contactName}),e(p,{children:e(ye,{active:t.active})}),e(d,{title:"Номер телефона:",children:t.contactPhone}),e(d,{title:"Почта:",children:t.contactEmail}),e(d,{title:"Было обновлено:",children:t.updateTime}),e(d,{title:"Автор обновления:",children:t.updateAuthor}),e(d,{title:"Позиция автора:",children:t.updateAuthorPosition})]})})})}function Le(n){const{model:t,...l}=n,[o,c]=g([t.$clientManagers,t.$clientMangersPending]);return a(f,{...l,children:[o.length!==0&&e(T,{children:o.map((m,i)=>e(Fe,{manager:m},i))}),!c&&o.length===0&&e(C,{flexGrow:"1",children:"Нет менеджеров"}),c&&e(C,{flexGrow:"1",children:e(N,{color:"blue.500"})})]})}function Fe(n){const{manager:t,...l}=n;return e(I,{...l,children:a(W,{children:[e(h,{fontSize:"md",fontWeight:"medium",children:t.name}),e(p,{children:e(b,{colorScheme:"orange",children:t.season})}),e(d,{title:"Позиция:",children:t.position}),e(d,{title:"Директория:",children:t.direction})]})})}function ve(n){const{contract:t,contractPending:l,...o}=n;return a(I,{...o,children:[t&&e(W,{children:a(f,{children:[a(f,{direction:"row",flexWrap:"wrap",children:[e(b,{colorScheme:"orange",children:t.season}),e(b,{colorScheme:"blue",children:t.status})]}),e(d,{title:"Номер:",children:t.number}),e(d,{title:"Клиент:",children:t.client}),e(d,{title:"Менеджер:",children:t.manager}),e(d,{title:"Сумма:",children:t.sum}),e(d,{title:"Адрес:",children:t.deliveryAddress}),e(d,{title:"Дата начала:",children:t.dateStart}),e(d,{title:"Дата окончания:",children:t.dateEnd})]})}),!l&&!t&&e(C,{flexGrow:"1",children:"Нету последнего контракта"}),l&&e(C,{flexGrow:"1",children:e(N,{color:"blue.500"})})]})}const j=Q(),U=Q(),F=u(null),v=se({defaultTab:"main",tabs:["main","subsidies","contracts"]}),J=E.createMap(),H=be(),P=ae.createClientPlots(),$=G.createLandsToLand({lands:P.$clientPlots.map(ke)}),_=we(),V=Te(),D=xe(),S=Pe(),He=r.createTable({data:S.$clientSubsidies,tableGenerateCb:()=>({})}),y=$e(),Ie=r.createTable({data:y.$clientContracts,tableGenerateCb:()=>({})}),X=le({map:J.$map,layer:{clientPlots:P.$clientPlots.map(n=>({positions:ce(n)})),clientPlot:$.$land.map(n=>({positions:(n==null?void 0:n.geometryRings)??[]}))}});M({clock:j,fn:({clientId:n})=>n,target:F});M({clock:F,filter:n=>n!==null,fn:n=>({clientId:n}),target:[H.getClientFx,V.getClientManagersFx,D.getClientLastContractFx]});const We=M({clock:[v.$tab,F],source:{tab:v.$tab,clientId:F},filter:n=>n.clientId!==null});We.watch(({tab:n,clientId:t})=>{t&&(n.index===0&&(P.getClientPlotsFx({clientId:t}),_.getClientPointsFx({clientId:t})),n.index===1&&S.getClientSubsidies({clientId:t}),n.index===2&&y.getClientContractsFx({clientId:t}))});M({clock:P.$clientPlots,filter:n=>n.length>0,target:X.clientPlots});M({clock:$.landClicked,filter:n=>n!==null,target:X.clientPlot});he({clock:U,target:[P.$clientPlots,$.$landId,S.$clientSubsidies,y.$clientContracts]});function ke(n){return n.map(t=>({...t,id:t.plotId}))}function at(){const[n,t]=g([j,U]),[l,o]=g([v.$tab,v.tabChanged]),{clientId:c}=ie();return x.useEffect(()=>(n({clientId:Number(c)}),()=>t()),[n,t,c]),a(p,{children:[e(re,{}),e(de,{maxW:"container.xl",py:"10",children:a(f,{direction:{base:"column",md:"row"},spacing:"2",children:[e(A,{w:{base:"100%",md:"75%"},minH:"0",children:a(ge,{index:l.index,onChange:o,isFitted:!0,shadow:"md",rounded:"md",children:[a(pe,{children:[e(z,{children:"Основная"}),e(z,{children:"Субсидий"}),e(z,{children:"Контракты"})]}),a(fe,{children:[e(B,{children:e(Ge,{})}),e(B,{children:e(_e,{})}),e(B,{children:e(De,{})})]})]})}),e(A,{w:{base:"100%",md:"25%"},minH:"0",children:a(f,{children:[e(ze,{}),a(p,{shadow:"md",rounded:"md",p:"3",children:[e(p,{px:"2",py:"2",children:e(h,{fontSize:"xl",fontWeight:"bold",color:"blue.500",children:"Контакты"})}),e(Ne,{model:H,minH:"15rem",maxH:"20rem",overflow:"auto"})]}),a(p,{shadow:"md",rounded:"md",p:"3",children:[e(p,{px:"2",py:"2",children:e(h,{fontSize:"xl",fontWeight:"bold",color:"blue.500",children:"Менеджеры"})}),e(Le,{model:V,minH:"15rem",maxH:"20rem",overflow:"auto"})]}),a(p,{shadow:"md",rounded:"md",p:"3",children:[e(p,{px:"2",py:"2",children:e(h,{fontSize:"xl",fontWeight:"bold",color:"blue.500",children:"Последний контракт"})}),e(Be,{})]})]})})]})})]})}function ze(){const[n,t]=g([H.$client,H.$clientPending]);return e(T,{children:e(Se,{client:n,clientPending:t,minH:"20rem",children:e(T,{})})})}function Be(){const[n,t]=g([D.$clientLastContract,D.$clientLastContractPending]);return e(T,{children:e(ve,{contract:n,contractPending:t,minH:"10rem"})})}function Ge(){const[n,t]=g([_.$clientPoints,_.$clientPointsPending]),[l,o,c]=g([P.$clientPlots,$.$land,P.$clientPlotsPending]),m=x.useMemo(()=>l.reduce((i,s)=>(i.findIndex(Y=>Y.plotCultId===s.plotCultId)===-1&&i.push({plotCultId:s.plotCultId,plotCultName:s.plotCultName}),i),[]),[l]);return t||c?e(C,{flexGrow:"1",minH:"30rem",children:e(N,{colorScheme:"blue"})}):e(p,{position:"relative",children:a(L,{templateColumns:"1fr 300px",children:[a(E.Map,{model:J,style:{height:"100%",borderRadius:"inherit"},containerProps:{height:"max(50vh, 300px)",shadow:"md",borderRadius:"20px"},children:[e(G.Lands,{model:$,children:({land:i,onClick:s})=>e(R,{positions:i.geometryRings,pathOptions:{color:"blue"},eventHandlers:{click:()=>s(i.id)}})}),e(G.Land,{model:$,children:({land:i})=>e(R,{positions:i.geometryRings,pathOptions:{color:"black"}})}),n.map((i,s)=>e(Ce,{position:i.coordinate,children:e(me,{sticky:!0,opacity:.8,direction:"bottom",children:a(f,{direction:"row",align:"center",children:[e(h,{fontSize:"sm",fontWeight:"bold",children:"Клиент:"}),e(h,{children:i.name}),e(h,{fontSize:"sm",fontWeight:"bold",children:"Категория:"}),e(h,{children:i.category})]})})},s))]}),a(f,{p:"2",children:[e(f,{direction:"row",flexWrap:"wrap",children:m.map((i,s)=>{const k=ue[i.plotCultId]??"red";return e(b,{bgColor:k.bgColor,color:k.color,whiteSpace:"pre-wrap",children:i.plotCultName},s)})}),a(L,{templateColumns:"auto 1fr",gap:"1",alignItems:"center",children:[e(h,{fontSize:"md",fontWeight:"medium",children:"Участок:"}),e(h,{fontSize:"sm",children:o?o.plotName:"Не выбран"})]}),a(L,{templateColumns:"auto 1fr",gap:"1",alignItems:"center",children:[e(h,{fontSize:"md",fontWeight:"medium",children:"Культура:"}),e(h,{fontSize:"sm",children:o?o.plotCultName:"Не выбран"})]}),a(L,{templateColumns:"auto 1fr",gap:"1",alignItems:"center",children:[e(h,{fontSize:"md",fontWeight:"medium",children:"Площадь:"}),e(h,{fontSize:"sm",children:o?`${o.plotArea} га`:"Не выбран"})]})]})]})})}function _e(){const[n,t]=g([S.$clientSubsidies,S.$clientSubsidiesPending]),[l]=g([He.$tableState]),o=x.useMemo(()=>[{header:()=>e(r.Th,{color:"white",children:"Заявитель"}),cell:({item:i})=>e(r.Td,{children:i.appName})},{header:()=>e(r.Th,{color:"white",children:"Вид деятельности"}),cell:({item:i})=>e(r.Td,{children:i.activity})},{header:()=>e(r.Th,{isNumeric:!0,color:"white",children:"Сумма"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.sum})},{header:()=>e(r.Th,{color:"white",children:"Единица измерения"}),cell:({item:i})=>e(r.Td,{children:i.unit})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Дата подачи"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.paymentDate})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Дата оплаты"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.paymentDate})},{header:()=>e(r.Th,{color:"white",children:"Получатель"}),cell:({item:i})=>e(r.Td,{children:i.providerName})}],[]),{getHeaders:c,getCells:m}=O({data:n,columns:o,tableState:l});return e(r.TableContainer,{borderColor:"lightgray",borderWidth:"1px",borderRadius:"md",boxShadow:"md",overflow:"auto",whiteSpace:"pre-wrap",w:"full",h:"fit-content",children:a(r.Table,{sx:{borderCollapse:"collapse"},overflow:"hidden",position:"relative",borderStyle:"hidden",children:[e(r.THead,{bgColor:"blue.500",children:e(r.Tr,{children:c().map((i,s)=>e(x.Fragment,{children:i},s))})}),e(r.TBody,{columnLength:o.length,empty:{empty:n.length===0},loading:{loading:t},children:m().map((i,s)=>e(r.Tr,{children:e(T,{children:i})},s))})]})})}function De(){const[n,t]=g([y.$clientContracts,y.$clientContractsPending]),[l]=g([Ie.$tableState]),o=x.useMemo(()=>[{header:()=>e(r.Th,{color:"white",children:"Контракт"}),cell:({item:i})=>e(r.Td,{children:i.name})},{header:()=>e(r.Th,{color:"white",children:"Способ доставки"}),cell:({item:i})=>e(r.Td,{children:i.deliveryMethod})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Сезон"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.season})},{header:()=>e(r.Th,{color:"white",children:"Статус"}),cell:({item:i})=>e(r.Td,{children:i.status})},{header:()=>e(r.Th,{color:"white",children:"Контрак менеджера"}),cell:({item:i})=>e(r.Td,{children:i.managerContract})},{header:()=>e(r.Th,{color:"white",children:"Основной контракт"}),cell:({item:i})=>e(r.Td,{children:i.mainContract})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Цифры"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.number})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Сумма"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.sum})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Дата создания"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.dateCreate})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Дата начала"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.dateStart})},{header:()=>e(r.Th,{color:"white",isNumeric:!0,children:"Дата окончания"}),cell:({item:i})=>e(r.Td,{isNumeric:!0,children:i.dateEnd})},{header:()=>e(r.Th,{color:"white",children:"Подтверждение"}),cell:({item:i})=>e(r.Td,{textAlign:"center",children:i.success?e(b,{colorScheme:"green",children:"Подтверждено"}):e(b,{colorScheme:"red",children:"Не Подтверждено"})})}],[]),{getHeaders:c,getCells:m}=O({data:n,columns:o,tableState:l});return e(r.TableContainer,{borderColor:"lightgray",borderWidth:"1px",borderRadius:"md",boxShadow:"md",overflowY:"auto",overflowX:"auto",whiteSpace:"pre-wrap",w:"full",maxH:"container.sm",children:a(r.Table,{sx:{borderCollapse:"collapse"},overflow:"hidden",position:"relative",borderStyle:"hidden",children:[e(r.THead,{bgColor:"blue.500",position:"sticky",top:"0",zIndex:"1",children:e(r.Tr,{children:c().map((i,s)=>e(x.Fragment,{children:i},s))})}),e(r.TBody,{columnLength:o.length,empty:{empty:n.length===0},loading:{loading:t},children:m().map((i,s)=>e(r.Tr,{children:e(T,{children:i})},s))})]})})}export{at as ClientProfilePage};
//# sourceMappingURL=index-a9068786.js.map
