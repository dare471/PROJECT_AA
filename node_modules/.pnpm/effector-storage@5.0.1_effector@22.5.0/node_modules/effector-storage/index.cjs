"use strict";var e=require("effector"),r=new Map,t=e.createEvent();function o(o){return a=>function({adapter:o,store:a,source:i=a,target:f=a,clock:s=i,done:n,fail:d=t,finally:u,pickup:c,key:l,keyPrefix:p=""}){if(!o)throw Error("Adapter is not defined");if(!i)throw Error("Store or source is not defined");if(!f)throw Error("Target is not defined");if(!l&&i.shortName===i.id)throw Error("Key or name is not defined");if(i===f&&!e.is.store(i))throw Error("Source must be different from target");var v=l||i.shortName,y=function(t,o){var a=r.get(t);void 0===a&&(a=new Map,r.set(t,a));var i=a.get(o);return void 0!==i||(i=e.createStore(null,{serialize:"ignore"}),a.set(o,i)),i}(o.keyArea||o,p+v),k=e.createNode(),m=()=>e.clearNode(k),w=e=>({status:r,params:t,result:o,error:a})=>"done"===r?{status:r,key:v,keyPrefix:p,operation:e,value:"get"===e?o:t}:{status:r,key:v,keyPrefix:p,operation:e,value:t,error:a};return e.withRegion(k,(()=>{var r=e.createEffect(),t=e.createEffect(),a=e.createEvent(),l=a.filterMap((({status:e,key:r,keyPrefix:t,operation:o,value:a})=>"done"===e?{key:r,keyPrefix:t,operation:o,value:a}:void 0)),k=a.filterMap((({status:e,key:r,keyPrefix:t,operation:o,error:a,value:i})=>"fail"===e?{key:r,keyPrefix:t,operation:o,error:a,value:i}:void 0)),m=o(p+v,r);r.use(m.get),t.use(m.set);var g=e.createEvent();e.sample({source:i,clock:s,target:g}),e.guard({source:e.sample(y,g,((e,r)=>[r,e])),filter:([e,r])=>e!==r,target:t.prepend((([e])=>e))}),e.forward({from:[r.doneData,t],to:y}),e.forward({from:[r.doneData,y],to:f}),e.forward({from:[r.finally.map(w("get")),t.finally.map(w("set"))],to:a}),e.forward({from:k,to:d}),n&&e.forward({from:l,to:n}),u&&e.forward({from:a,to:u}),c?e.forward({from:c,to:r.prepend((()=>{}))}):r()})),m.unsubscribe=m}({...o,...a})}t.watch((e=>console.error(e.error)));var a=o();exports.createPersist=o,exports.persist=a;
//# sourceMappingURL=index.cjs.map
