{"version":3,"file":"index.js","sources":["../../src/storage/index.ts"],"sourcesContent":["import type { StorageAdapter } from '..'\n\nexport interface StorageConfig {\n  storage: Storage\n  sync?: boolean\n  serialize?: (value: any) => string\n  deserialize?: (value: string) => any\n}\n\n/**\n * Generic `Storage` adapter factory\n */\nexport function storage({\n  storage,\n  sync = false,\n  serialize = JSON.stringify,\n  deserialize = JSON.parse,\n}: StorageConfig): StorageAdapter {\n  const adapter: StorageAdapter = <State>(\n    key: string,\n    update: (raw?: any) => any\n  ) => {\n    if (sync && typeof addEventListener !== 'undefined') {\n      addEventListener('storage', (e) => {\n        if (e.storageArea === storage) {\n          if (e.key === key) update(e.newValue)\n\n          // `key` attribute is `null` when the change is caused by the storage `clear()` method\n          if (e.key === null) update(null)\n        }\n      })\n    }\n\n    return {\n      get(value?: string | null) {\n        const item = value !== undefined ? value : storage.getItem(key)\n        return value === undefined && item === null\n          ? undefined\n          : deserialize(item as any)\n      },\n\n      set(value: State) {\n        storage.setItem(key, serialize(value))\n      },\n    }\n  }\n\n  adapter.keyArea = storage\n  return adapter\n}\n"],"names":["storage","sync","serialize","JSON","stringify","deserialize","parse","adapter","key","update","addEventListener","e","storageArea","newValue","get","value","item","undefined","getItem","set","setItem","keyArea"],"mappings":"AAYO,SAASA,GAAQA,QACtBA,EADsBC,KAEtBA,GAAO,EAFeC,UAGtBA,EAAYC,KAAKC,UAHKC,YAItBA,EAAcF,KAAKG,QAEnB,IAAMC,EAA0B,CAC9BC,EACAC,KAEIR,GAAoC,oBAArBS,kBACjBA,iBAAiB,WAAYC,IACvBA,EAAEC,cAAgBZ,IAChBW,EAAEH,MAAQA,GAAKC,EAAOE,EAAEE,UAGd,OAAVF,EAAEH,KAAcC,EAAO,MAC5B,IAIE,CACLK,IAAIC,GACF,IAAMC,OAAiBC,IAAVF,EAAsBA,EAAQf,EAAQkB,QAAQV,GAC3D,YAAiBS,IAAVF,GAAgC,OAATC,OAC1BC,EACAZ,EAAYW,EALb,EAQLG,IAAIJ,GACFf,EAAQoB,QAAQZ,EAAKN,EAAUa,GAChC,IAKL,OADAR,EAAQc,QAAUrB,EACXO,CACR"}