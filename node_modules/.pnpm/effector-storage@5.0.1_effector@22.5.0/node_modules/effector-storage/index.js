import{createStore as e,createEvent as r,is as o,createNode as t,withRegion as a,createEffect as i,sample as n,guard as f,forward as s,clearNode as u}from"effector";var l=new Map,d=r();function p(p){return y=>function({adapter:p,store:y,source:k=y,target:c=y,clock:m=k,done:v,fail:g=d,finally:h,pickup:w,key:x,keyPrefix:P=""}){if(!p)throw Error("Adapter is not defined");if(!k)throw Error("Store or source is not defined");if(!c)throw Error("Target is not defined");if(!x&&k.shortName===k.id)throw Error("Key or name is not defined");if(k===c&&!o.store(k))throw Error("Source must be different from target");var E=x||k.shortName,M=function(r,o){var t=l.get(r);void 0===t&&(t=new Map,l.set(r,t));var a=t.get(o);return void 0!==a||(a=e(null,{serialize:"ignore"}),t.set(o,a)),a}(p.keyArea||p,P+E),b=t(),A=()=>u(b),D=e=>({status:r,params:o,result:t,error:a})=>"done"===r?{status:r,key:E,keyPrefix:P,operation:e,value:"get"===e?t:o}:{status:r,key:E,keyPrefix:P,operation:e,value:o,error:a};return a(b,(()=>{var e=i(),o=i(),t=r(),a=t.filterMap((({status:e,key:r,keyPrefix:o,operation:t,value:a})=>"done"===e?{key:r,keyPrefix:o,operation:t,value:a}:void 0)),u=t.filterMap((({status:e,key:r,keyPrefix:o,operation:t,error:a,value:i})=>"fail"===e?{key:r,keyPrefix:o,operation:t,error:a,value:i}:void 0)),l=p(P+E,e);e.use(l.get),o.use(l.set);var d=r();n({source:k,clock:m,target:d}),f({source:n(M,d,((e,r)=>[r,e])),filter:([e,r])=>e!==r,target:o.prepend((([e])=>e))}),s({from:[e.doneData,o],to:M}),s({from:[e.doneData,M],to:c}),s({from:[e.finally.map(D("get")),o.finally.map(D("set"))],to:t}),s({from:u,to:g}),v&&s({from:a,to:v}),h&&s({from:t,to:h}),w?s({from:w,to:e.prepend((()=>{}))}):e()})),A.unsubscribe=A}({...p,...y})}d.watch((e=>console.error(e.error)));var y=p();export{p as createPersist,y as persist};
//# sourceMappingURL=index.js.map
