{"version":3,"file":"index.development.js","sources":["../../../../node_modules/@reach/observe-rect/dist/observe-rect.esm.js","../../src/useIsomorphicLayoutEffect.ts","../../src/useRect.ts","../../src/index.tsx"],"sourcesContent":["var props = [\"bottom\", \"height\", \"left\", \"right\", \"top\", \"width\"];\n\nvar rectChanged = function rectChanged(a, b) {\n  if (a === void 0) {\n    a = {};\n  }\n\n  if (b === void 0) {\n    b = {};\n  }\n\n  return props.some(function (prop) {\n    return a[prop] !== b[prop];\n  });\n};\n\nvar observedNodes = /*#__PURE__*/new Map();\nvar rafId;\n\nvar run = function run() {\n  var changedStates = [];\n  observedNodes.forEach(function (state, node) {\n    var newRect = node.getBoundingClientRect();\n\n    if (rectChanged(newRect, state.rect)) {\n      state.rect = newRect;\n      changedStates.push(state);\n    }\n  });\n  changedStates.forEach(function (state) {\n    state.callbacks.forEach(function (cb) {\n      return cb(state.rect);\n    });\n  });\n  rafId = window.requestAnimationFrame(run);\n};\n\nfunction observeRect(node, cb) {\n  return {\n    observe: function observe() {\n      var wasEmpty = observedNodes.size === 0;\n\n      if (observedNodes.has(node)) {\n        observedNodes.get(node).callbacks.push(cb);\n      } else {\n        observedNodes.set(node, {\n          rect: undefined,\n          hasRectChanged: false,\n          callbacks: [cb]\n        });\n      }\n\n      if (wasEmpty) run();\n    },\n    unobserve: function unobserve() {\n      var state = observedNodes.get(node);\n\n      if (state) {\n        // Remove the callback\n        var index = state.callbacks.indexOf(cb);\n        if (index >= 0) state.callbacks.splice(index, 1); // Remove the node reference\n\n        if (!state.callbacks.length) observedNodes[\"delete\"](node); // Stop the loop\n\n        if (!observedNodes.size) cancelAnimationFrame(rafId);\n      }\n    }\n  };\n}\n\nexport default observeRect;\n//# sourceMappingURL=observe-rect.esm.js.map\n","import * as React from 'react'\n\nexport const useIsomorphicLayoutEffect =\n  typeof window !== 'undefined' ? React.useLayoutEffect : React.useEffect\n","import React from 'react'\nimport observeRect from '@reach/observe-rect'\nimport { useIsomorphicLayoutEffect } from './useIsomorphicLayoutEffect'\n\nexport interface Rect {\n  width: number\n  height: number\n}\n\nfunction rectReducer(state: Rect, action: { rect: Rect }) {\n  const rect = action.rect\n  if (state.height !== rect.height || state.width !== rect.width) {\n    return rect\n  }\n  return state\n}\n\nexport const useRect = <T extends HTMLElement>(\n  nodeRef: React.RefObject<T>,\n  initialRect: Rect = { width: 0, height: 0 },\n) => {\n  const [element, setElement] = React.useState(nodeRef.current)\n  const [rect, dispatch] = React.useReducer(rectReducer, initialRect)\n\n  const initialRectSet = React.useRef(false)\n\n  useIsomorphicLayoutEffect(() => {\n    if (nodeRef.current !== element) {\n      setElement(nodeRef.current)\n    }\n  })\n\n  useIsomorphicLayoutEffect(() => {\n    if (element && !initialRectSet.current) {\n      initialRectSet.current = true\n      const rect = element.getBoundingClientRect()\n      dispatch({ rect })\n    }\n  }, [element])\n\n  React.useEffect(() => {\n    if (!element) {\n      return\n    }\n\n    const observer = observeRect(element, (rect) => {\n      dispatch({ rect })\n    })\n\n    observer.observe()\n\n    return () => {\n      observer.unobserve()\n    }\n  }, [element])\n\n  return rect\n}\n","import * as React from 'react'\nimport { useRect, Rect } from './useRect'\nimport { useIsomorphicLayoutEffect } from './useIsomorphicLayoutEffect'\n\nconst defaultEstimateSize = () => 50\n\nconst defaultKeyExtractor = (index: number) => index\n\nconst defaultMeasureSize = (el: HTMLElement, horizontal: boolean) => {\n  const key = horizontal ? 'offsetWidth' : 'offsetHeight'\n\n  return el[key]\n}\n\ntype ScrollAlignment = 'start' | 'center' | 'end' | 'auto'\n\ninterface ScrollToOptions {\n  align: ScrollAlignment\n}\n\ninterface ScrollToOffsetOptions extends ScrollToOptions {}\n\ninterface ScrollToIndexOptions extends ScrollToOptions {}\n\nexport interface Range {\n  start: number\n  end: number\n  overscan: number\n  size: number\n}\n\nexport const defaultRangeExtractor = (range: Range) => {\n  const start = Math.max(range.start - range.overscan, 0)\n  const end = Math.min(range.end + range.overscan, range.size - 1)\n\n  const arr = []\n\n  for (let i = start; i <= end; i++) {\n    arr.push(i)\n  }\n\n  return arr\n}\n\ntype Key = number | string\n\ninterface Item {\n  key: Key\n  index: number\n  start: number\n  end: number\n  size: number\n}\n\nexport interface VirtualItem extends Item {\n  measureRef: (el: HTMLElement | null) => void\n}\n\nexport interface Options<T> {\n  size: number\n  parentRef: React.RefObject<T>\n  estimateSize?: (index: number) => number\n  overscan?: number\n  horizontal?: boolean\n  scrollToFn?: (\n    offset: number,\n    defaultScrollToFn?: (offset: number) => void,\n  ) => void\n  paddingStart?: number\n  paddingEnd?: number\n  useObserver?: (ref: React.RefObject<T>, initialRect?: Rect) => Rect\n  initialRect?: Rect\n  keyExtractor?: (index: number) => Key\n  onScrollElement?: React.RefObject<HTMLElement>\n  scrollOffsetFn?: (event?: Event) => number\n  rangeExtractor?: (range: Range) => number[]\n  measureSize?: (el: HTMLElement, horizontal: boolean) => number\n}\n\nexport const useVirtual = <T extends HTMLElement>({\n  size = 0,\n  estimateSize = defaultEstimateSize,\n  overscan = 1,\n  paddingStart = 0,\n  paddingEnd = 0,\n  parentRef,\n  horizontal = false,\n  scrollToFn,\n  useObserver,\n  initialRect,\n  onScrollElement,\n  scrollOffsetFn,\n  keyExtractor = defaultKeyExtractor,\n  measureSize = defaultMeasureSize,\n  rangeExtractor = defaultRangeExtractor,\n}: Options<T>) => {\n  const sizeKey = horizontal ? 'width' : 'height'\n  const scrollKey = horizontal ? 'scrollLeft' : 'scrollTop'\n\n  const latestRef = React.useRef<{\n    scrollOffset: number\n    measurements: Item[]\n    outerSize: number\n    totalSize: number\n  }>({\n    outerSize: 0,\n    scrollOffset: 0,\n    measurements: [],\n    totalSize: 0,\n  })\n\n  const [scrollOffset, setScrollOffset] = React.useState(0)\n  latestRef.current.scrollOffset = scrollOffset\n\n  const useMeasureParent = useObserver || useRect\n\n  const { [sizeKey]: outerSize } = useMeasureParent(parentRef, initialRect)\n\n  latestRef.current.outerSize = outerSize\n\n  const defaultScrollToFn = React.useCallback(\n    (offset: number) => {\n      if (parentRef.current) {\n        parentRef.current[scrollKey] = offset\n      }\n    },\n    [parentRef, scrollKey],\n  )\n\n  const resolvedScrollToFn = scrollToFn || defaultScrollToFn\n\n  const scrollTo = React.useCallback(\n    (offset: number) => {\n      resolvedScrollToFn(offset, defaultScrollToFn)\n    },\n    [defaultScrollToFn, resolvedScrollToFn],\n  )\n\n  const [measuredCache, setMeasuredCache] = React.useState<Record<Key, number>>(\n    {},\n  )\n\n  const measure = React.useCallback(() => setMeasuredCache({}), [])\n\n  const pendingMeasuredCacheIndexesRef = React.useRef<number[]>([])\n\n  const measurements = React.useMemo(() => {\n    const min =\n      pendingMeasuredCacheIndexesRef.current.length > 0\n        ? Math.min(...pendingMeasuredCacheIndexesRef.current)\n        : 0\n    pendingMeasuredCacheIndexesRef.current = []\n\n    const measurements = latestRef.current.measurements.slice(0, min)\n\n    for (let i = min; i < size; i++) {\n      const key = keyExtractor(i)\n      const measuredSize = measuredCache[key]\n      const start = measurements[i - 1] ? measurements[i - 1].end : paddingStart\n      const size =\n        typeof measuredSize === 'number' ? measuredSize : estimateSize(i)\n      const end = start + size\n      measurements[i] = { index: i, start, size, end, key }\n    }\n    return measurements\n  }, [estimateSize, measuredCache, paddingStart, size, keyExtractor])\n\n  const totalSize = (measurements[size - 1]?.end || paddingStart) + paddingEnd\n\n  latestRef.current.measurements = measurements\n  latestRef.current.totalSize = totalSize\n\n  const element = onScrollElement ? onScrollElement.current : parentRef.current\n\n  const scrollOffsetFnRef = React.useRef(scrollOffsetFn)\n  scrollOffsetFnRef.current = scrollOffsetFn\n\n  useIsomorphicLayoutEffect(() => {\n    if (!element) {\n      setScrollOffset(0)\n\n      return\n    }\n\n    const onScroll = (event?: Event) => {\n      const offset = scrollOffsetFnRef.current\n        ? scrollOffsetFnRef.current(event)\n        : element[scrollKey]\n\n      setScrollOffset(offset)\n    }\n\n    onScroll()\n\n    element.addEventListener('scroll', onScroll, {\n      capture: false,\n      passive: true,\n    })\n\n    return () => {\n      element.removeEventListener('scroll', onScroll)\n    }\n  }, [element, scrollKey])\n\n  const { start, end } = calculateRange(latestRef.current)\n\n  const indexes = React.useMemo(\n    () =>\n      rangeExtractor({\n        start,\n        end,\n        overscan,\n        size: measurements.length,\n      }),\n    [start, end, overscan, measurements.length, rangeExtractor],\n  )\n\n  const measureSizeRef = React.useRef(measureSize)\n  measureSizeRef.current = measureSize\n\n  const virtualItems: VirtualItem[] = React.useMemo(() => {\n    const virtualItems = []\n\n    for (let k = 0, len = indexes.length; k < len; k++) {\n      const i = indexes[k]\n      const measurement = measurements[i]\n\n      const item = {\n        ...measurement,\n        measureRef: (el: HTMLElement | null) => {\n          if (el) {\n            const measuredSize = measureSizeRef.current(el, horizontal)\n\n            if (measuredSize !== item.size) {\n              const { scrollOffset } = latestRef.current\n\n              if (item.start < scrollOffset) {\n                defaultScrollToFn(scrollOffset + (measuredSize - item.size))\n              }\n\n              pendingMeasuredCacheIndexesRef.current.push(i)\n\n              setMeasuredCache((old) => ({\n                ...old,\n                [item.key]: measuredSize,\n              }))\n            }\n          }\n        },\n      }\n\n      virtualItems.push(item)\n    }\n\n    return virtualItems\n  }, [indexes, defaultScrollToFn, horizontal, measurements])\n\n  const mountedRef = React.useRef(false)\n\n  useIsomorphicLayoutEffect(() => {\n    if (mountedRef.current) {\n      setMeasuredCache({})\n    }\n    mountedRef.current = true\n  }, [estimateSize])\n\n  const scrollToOffset = React.useCallback(\n    (\n      toOffset: number,\n      { align }: ScrollToOffsetOptions = { align: 'start' },\n    ) => {\n      const { scrollOffset, outerSize } = latestRef.current\n\n      if (align === 'auto') {\n        if (toOffset <= scrollOffset) {\n          align = 'start'\n        } else if (toOffset >= scrollOffset + outerSize) {\n          align = 'end'\n        } else {\n          align = 'start'\n        }\n      }\n\n      if (align === 'start') {\n        scrollTo(toOffset)\n      } else if (align === 'end') {\n        scrollTo(toOffset - outerSize)\n      } else if (align === 'center') {\n        scrollTo(toOffset - outerSize / 2)\n      }\n    },\n    [scrollTo],\n  )\n\n  const tryScrollToIndex = React.useCallback(\n    (\n      index: number,\n      { align, ...rest }: ScrollToIndexOptions = { align: 'auto' },\n    ) => {\n      const { measurements, scrollOffset, outerSize } = latestRef.current\n\n      const measurement = measurements[Math.max(0, Math.min(index, size - 1))]\n\n      if (!measurement) {\n        return\n      }\n\n      if (align === 'auto') {\n        if (measurement.end >= scrollOffset + outerSize) {\n          align = 'end'\n        } else if (measurement.start <= scrollOffset) {\n          align = 'start'\n        } else {\n          return\n        }\n      }\n\n      const toOffset =\n        align === 'center'\n          ? measurement.start + measurement.size / 2\n          : align === 'end'\n          ? measurement.end\n          : measurement.start\n\n      scrollToOffset(toOffset, { align, ...rest })\n    },\n    [scrollToOffset, size],\n  )\n\n  const scrollToIndex = React.useCallback(\n    (index: number, options?: ScrollToIndexOptions) => {\n      // We do a double request here because of\n      // dynamic sizes which can cause offset shift\n      // and end up in the wrong spot. Unfortunately,\n      // we can't know about those dynamic sizes until\n      // we try and render them. So double down!\n      tryScrollToIndex(index, options)\n      requestAnimationFrame(() => {\n        tryScrollToIndex(index, options)\n      })\n    },\n    [tryScrollToIndex],\n  )\n\n  return {\n    virtualItems,\n    totalSize,\n    scrollToOffset,\n    scrollToIndex,\n    measure,\n  }\n}\n\nconst findNearestBinarySearch = (\n  low: number,\n  high: number,\n  getCurrentValue: (i: number) => number,\n  value: number,\n) => {\n  while (low <= high) {\n    let middle = ((low + high) / 2) | 0\n    let currentValue = getCurrentValue(middle)\n\n    if (currentValue < value) {\n      low = middle + 1\n    } else if (currentValue > value) {\n      high = middle - 1\n    } else {\n      return middle\n    }\n  }\n\n  if (low > 0) {\n    return low - 1\n  } else {\n    return 0\n  }\n}\n\nfunction calculateRange({\n  measurements,\n  outerSize,\n  scrollOffset,\n}: {\n  measurements: Item[]\n  outerSize: number\n  scrollOffset: number\n}) {\n  const size = measurements.length - 1\n  const getOffset = (index: number) => measurements[index].start\n\n  let start = findNearestBinarySearch(0, size, getOffset, scrollOffset)\n  let end = start\n\n  while (end < size && measurements[end].end < scrollOffset + outerSize) {\n    end++\n  }\n\n  return { start, end }\n}\n"],"names":["useIsomorphicLayoutEffect","window","React","useLayoutEffect","useEffect","rectReducer","state","action","rect","height","width","useRect","nodeRef","initialRect","useState","current","element","setElement","useReducer","dispatch","initialRectSet","useRef","getBoundingClientRect","observer","observeRect","observe","unobserve","defaultEstimateSize","defaultKeyExtractor","index","defaultMeasureSize","el","horizontal","key","defaultRangeExtractor","range","start","Math","max","overscan","end","min","size","arr","i","push","useVirtual","estimateSize","paddingStart","paddingEnd","parentRef","scrollToFn","useObserver","onScrollElement","scrollOffsetFn","keyExtractor","measureSize","rangeExtractor","sizeKey","scrollKey","latestRef","outerSize","scrollOffset","measurements","totalSize","setScrollOffset","useMeasureParent","defaultScrollToFn","useCallback","offset","resolvedScrollToFn","scrollTo","measuredCache","setMeasuredCache","measure","pendingMeasuredCacheIndexesRef","useMemo","length","slice","measuredSize","scrollOffsetFnRef","onScroll","event","addEventListener","capture","passive","removeEventListener","calculateRange","indexes","measureSizeRef","virtualItems","k","len","measurement","item","measureRef","old","mountedRef","scrollToOffset","toOffset","align","tryScrollToIndex","rest","scrollToIndex","options","requestAnimationFrame","findNearestBinarySearch","low","high","getCurrentValue","value","middle","currentValue","getOffset"],"mappings":"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"}