{"version":3,"file":"useRect.js","sources":["../../../../../src/useRect.ts"],"sourcesContent":["import React from 'react'\nimport observeRect from '@reach/observe-rect'\nimport { useIsomorphicLayoutEffect } from './useIsomorphicLayoutEffect'\n\nexport interface Rect {\n  width: number\n  height: number\n}\n\nfunction rectReducer(state: Rect, action: { rect: Rect }) {\n  const rect = action.rect\n  if (state.height !== rect.height || state.width !== rect.width) {\n    return rect\n  }\n  return state\n}\n\nexport const useRect = <T extends HTMLElement>(\n  nodeRef: React.RefObject<T>,\n  initialRect: Rect = { width: 0, height: 0 },\n) => {\n  const [element, setElement] = React.useState(nodeRef.current)\n  const [rect, dispatch] = React.useReducer(rectReducer, initialRect)\n\n  const initialRectSet = React.useRef(false)\n\n  useIsomorphicLayoutEffect(() => {\n    if (nodeRef.current !== element) {\n      setElement(nodeRef.current)\n    }\n  })\n\n  useIsomorphicLayoutEffect(() => {\n    if (element && !initialRectSet.current) {\n      initialRectSet.current = true\n      const rect = element.getBoundingClientRect()\n      dispatch({ rect })\n    }\n  }, [element])\n\n  React.useEffect(() => {\n    if (!element) {\n      return\n    }\n\n    const observer = observeRect(element, (rect) => {\n      dispatch({ rect })\n    })\n\n    observer.observe()\n\n    return () => {\n      observer.unobserve()\n    }\n  }, [element])\n\n  return rect\n}\n"],"names":["rectReducer","state","action","rect","height","width","useRect","nodeRef","initialRect","React","useState","current","element","setElement","useReducer","dispatch","initialRectSet","useRef","useIsomorphicLayoutEffect","getBoundingClientRect","useEffect","observer","observeRect","observe","unobserve"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AASA,SAASA,WAAT,CAAqBC,KAArB,EAAkCC,MAAlC,EAA0D;AACxD,MAAMC,IAAI,GAAGD,MAAM,CAACC,IAApB;;AACA,MAAIF,KAAK,CAACG,MAAN,KAAiBD,IAAI,CAACC,MAAtB,IAAgCH,KAAK,CAACI,KAAN,KAAgBF,IAAI,CAACE,KAAzD,EAAgE;AAC9D,WAAOF,IAAP;AACD;;AACD,SAAOF,KAAP;AACD;;IAEYK,OAAO,GAAG,SAAVA,OAAU,CACrBC,OADqB,EAErBC,WAFqB,EAGlB;AAAA,MADHA,WACG;AADHA,IAAAA,WACG,GADiB;AAAEH,MAAAA,KAAK,EAAE,CAAT;AAAYD,MAAAA,MAAM,EAAE;AAApB,KACjB;AAAA;;AACH,wBAA8BK,yBAAK,CAACC,QAAN,CAAeH,OAAO,CAACI,OAAvB,CAA9B;AAAA,MAAOC,OAAP;AAAA,MAAgBC,UAAhB;;AACA,0BAAyBJ,yBAAK,CAACK,UAAN,CAAiBd,WAAjB,EAA8BQ,WAA9B,CAAzB;AAAA,MAAOL,IAAP;AAAA,MAAaY,QAAb;;AAEA,MAAMC,cAAc,GAAGP,yBAAK,CAACQ,MAAN,CAAa,KAAb,CAAvB;AAEAC,EAAAA,mDAAyB,CAAC,YAAM;AAC9B,QAAIX,OAAO,CAACI,OAAR,KAAoBC,OAAxB,EAAiC;AAC/BC,MAAAA,UAAU,CAACN,OAAO,CAACI,OAAT,CAAV;AACD;AACF,GAJwB,CAAzB;AAMAO,EAAAA,mDAAyB,CAAC,YAAM;AAC9B,QAAIN,OAAO,IAAI,CAACI,cAAc,CAACL,OAA/B,EAAwC;AACtCK,MAAAA,cAAc,CAACL,OAAf,GAAyB,IAAzB;;AACA,UAAMR,KAAI,GAAGS,OAAO,CAACO,qBAAR,EAAb;;AACAJ,MAAAA,QAAQ,CAAC;AAAEZ,QAAAA,IAAI,EAAJA;AAAF,OAAD,CAAR;AACD;AACF,GANwB,EAMtB,CAACS,OAAD,CANsB,CAAzB;AAQAH,EAAAA,yBAAK,CAACW,SAAN,CAAgB,YAAM;AACpB,QAAI,CAACR,OAAL,EAAc;AACZ;AACD;;AAED,QAAMS,QAAQ,GAAGC,0BAAW,CAACV,OAAD,EAAU,UAACT,IAAD,EAAU;AAC9CY,MAAAA,QAAQ,CAAC;AAAEZ,QAAAA,IAAI,EAAJA;AAAF,OAAD,CAAR;AACD,KAF2B,CAA5B;AAIAkB,IAAAA,QAAQ,CAACE,OAAT;AAEA,WAAO,YAAM;AACXF,MAAAA,QAAQ,CAACG,SAAT;AACD,KAFD;AAGD,GAdD,EAcG,CAACZ,OAAD,CAdH;AAgBA,SAAOT,IAAP;AACD;;;;"}