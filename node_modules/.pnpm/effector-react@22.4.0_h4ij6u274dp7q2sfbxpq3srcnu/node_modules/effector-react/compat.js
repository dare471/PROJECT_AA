'use strict';function e(e){return e&&'object'==typeof e&&'default'in e?e.default:e}function t(e,t,n,r){var o=[p.step.run({fn:function(e){return t(e)}})];if(r&&o.unshift(r),n){var u=p.createNode({node:o}),a=e.graphite.id,i=n.additionalLinks,c=i[a]||[];return i[a]=c,c.push(u),function(){var e=c.indexOf(u);-1!==e&&c.splice(e,1),p.clearNode(u)}}var s=p.createNode({node:o,parent:[e],family:{owners:e}});return function(){p.clearNode(s)}}function n(e,t){return t.displayName=e,t}function r(e,n){p.is.store(e)||b('expect useStore argument to be a store');var r=m.useCallback((function(r){return t(e,r,n)}),[e,n]),o=m.useCallback((function(){return h(e,n)}),[e,n]);return d.useSyncExternalStore(r,o,o)}function o(e,n){var r,o,u,a,i=e[0],c=e[1],s=S;if(c)r=c,u=i,a=[];else{r=i.fn,u=i.store,a=i.keys,o=i.defaultValue;var f=i.updateFilter;s=void 0===f?S:f}p.is.store(u)||b('useStoreMap expects a store'),Array.isArray(a)||b('useStoreMap expects an array as keys'),'function'!=typeof r&&b('useStoreMap expects a function');var l=m.useCallback((function(e){return t(u,e,n)}),[u,n]),v=m.useCallback((function(){return h(u,n)}),[u,n]),d=m.useRef(),x=m.useRef(),g=m.useRef(a);return y.useSyncExternalStoreWithSelector(l,v,v,(function(e){if(d.current!==e||!function(e,t){if(!e||!t||e.length!==t.length)return 0;for(var n=1,r=0;r<e.length;r++)if(e[r]!==t[r]){n=0;break}return n}(g.current,a)){var t=r(e,a);void 0===t&&void 0!==o&&(t=o),d.current=e,g.current=a,void 0!==t&&(x.current=t)}return x.current}),(function(e,t){return!s(t,e)}))}function u(e){var t=m.useContext(x);return e&&!t&&b('No scope found, consider adding <Provider> to app root'),t}function a(e,t){return r(e,u(null==t?void 0:t.forceScope))}function i(e,t){function r(e){var n=m.useRef(e),r=a(o);g((function(){return i({props:n.current,state:o.getState()}),function(){c({props:n.current,state:o.getState()})}}),[]);var u=t(e,r);return n.current=e,u}var o;p.is.store(e)?o=e:'object'==typeof e&&null!==e?o=p.combine(e):b('shape should be a store or object with stores');var u='Unknown';o&&o.shortName&&(u=o.shortName);var i=p.createEvent(),c=p.createEvent();return r.mounted=i,r.unmounted=c,n(u+".View",r)}function c(e,t){var n,r=t?e:e[0];(function(e){if(!e)throw Error('expect first argument be an object')})(C(n=r)||function(e){return'function'==typeof e}(n));var o=r.or,u=r.and;if(u){var a=t?u:u[0];if(C(a)&&'and'in a){var i=c(u,t);e=i[0],o=Object.assign({},o,i[1])}else e=u}return[e,o]}function s(e,t){void 0===t&&(t={});var n=m.useRef({value:null,count:0});g((function(){return e.open(n.current.value),function(){return e.close(n.current.value)}}),[e]),function(e,t){if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return 0;for(var o=0;o<n.length;o++){var u=n[o];if(e[u]!==t[u])return 0}return 1}return 0}(n.current.value,t)||(n.current.value=t,n.current.count+=1),g((function(){e.set(n.current.value)}),[n.current.count])}function f(e){function t(e){return u(t,e),null}var r=e.domain,o=e.defaultState,u=e.hook,a=E({or:e.maybeConfig,and:e.mainConfig}),i=(r?r.compositeName.fullName+"/":'')+(a.name||'gate'),c=p.createEvent({name:i+".set",sid:a.sid?a.sid+"|set":void 0}),s=p.createEvent({name:i+".open",sid:a.sid?a.sid+"|open":void 0}),f=p.createEvent({name:i+".close",sid:a.sid?a.sid+"|close":void 0}),l=p.createStore(Boolean(0),{name:i+".status",serialize:'ignore'}).on(s,(function(){return Boolean(1)})).on(f,(function(){return Boolean(0)})),v=p.createStore(o,{name:i+".state",sid:a.sid}).on(c,(function(e,t){return t})).on(s,(function(e,t){return t})).reset(f);if(r){var d=r.hooks;p.launch({target:[d.store,d.store,d.event,d.event,d.event],params:[l,v,s,f,c]})}return t.open=s,t.close=f,t.status=l,t.state=v,t.set=c,n("Gate:"+i,t)}function l(e,t){var n,r,o,u=c(t&&C(n=t[0])&&(n.and||n.or)?t:[{and:t}]),a=u[0],i=a[0],s=a[1],f={},l={},v=u[1];return'string'==typeof i?(l={name:i},C(o=s)&&'sid'in o||(f=s||{})):function(e){return C(e)&&('domain'in e||'defaultState'in e||'name'in e)}(i)&&(l=i,f=i.defaultState||{},r=i.domain),{hook:e,domain:r,defaultState:f,mainConfig:l,maybeConfig:v}}Object.defineProperty(exports,'__esModule',{value:1});var v=require('react'),p=require('effector/compat'),d=require('use-sync-external-store/shim/index.js'),y=require('use-sync-external-store/shim/with-selector.js'),m=e(v),b=function(e){throw Error(e)},h=function(e,t){return t?t.getState(e):e.getState()},S=function(e,t){return e!==t},x=m.createContext(null),g='undefined'!=typeof window?m.useLayoutEffect:m.useEffect,k=function(e){return console.error(e+" is deprecated")},j=function(e){return function(t){var r=e;return'function'!=typeof e&&(r=t,t=e),n("Connect("+(r.displayName||r.name||'Unknown')+")",(function(e){return m.createElement(r,Object.assign({},e,a(t)))}))}},C=function(e){return'object'==typeof e&&null!==e},E=function e(t,n){return void 0===n&&(n={}),C(t)&&(e(t.or,n),function(e){for(var t in e)o=t,function(e){return void 0===e}(r=e[t])||'or'===o||'and'===o||(n[o]=r);var r,o}(t),e(t.and,n)),n};exports.Provider=x.Provider,exports.connect=j,exports.createComponent=i,exports.createContextComponent=function(e,t,r){return k('createContextComponent'),n((e.shortName||'Unknown')+".ContextComponent",(function(n){var o=m.useContext(t),u=a(e);return r(n,u,o)}))},exports.createGate=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return f(l(s,t))},exports.createReactState=function(e,t){return k('createReactState'),j(t)(e)},exports.createStoreConsumer=function(e){return i(e,(function(e,t){return(0,e.children)(t)}))},exports.useEvent=function(e,t){return function(e,t){if(!t)return e;var n=p.is.unit(e)||'object'!=typeof e?{event:e}:e;return m.useMemo((function(){if(p.is.unit(e))return p.scopeBind(e,{scope:t});var n=Array.isArray(e)?[]:{};for(var r in e)n[r]=p.scopeBind(e[r],{scope:t});return n}),[t].concat(Object.keys(n),Object.values(n)))}(e,u(null==t?void 0:t.forceScope))},exports.useGate=s,exports.useList=function(e,t,a){return function(e,t,u){var a,i,c,s=[];'object'==typeof t&&null!==t?(t.keys&&(s=t.keys),a=t.fn,i=t.getKey,c=t.placeholder):a=t,p.is.store(e)||b('expect useList first argument to be a store'),'function'!=typeof a&&b("expect useList's renderItem to be a function"),Array.isArray(s)||b("expect useList's keys to be an array");var f=m.useMemo((function(){var t=n((e.shortName||'Unknown')+".Item",(function(t){var n=t.index,r=t.keys;if(l.current[1])return l.current[0](t.value,t.keyVal);var a=o([{store:e,keys:[n].concat(r),fn:function(e,t){return e[t[0]]}}],u);return l.current[0](a,n)}));return m.memo(t)}),[e,u,!!i]),l=m.useRef([a,i]);l.current=[a,i];var v=m.useMemo((function(){return s}),s);if(i){var d=r(e,u);return 0===d.length&&c?c:d.map((function(e){var t=l.current[1](e);return m.createElement(f,{keyVal:t,key:t,keys:v,value:e})}))}var y=o([{store:e,keys:[e],fn:function(e){return e.length}}],u);return 0===y&&c?c:Array.from({length:y},(function(e,t){return m.createElement(f,{index:t,key:t,keys:v})}))}(e,t,u(null==a?void 0:a.forceScope))},exports.useStore=a,exports.useStoreMap=function(e,t){return o([e,t],u(null==e?void 0:e.forceScope))},exports.useUnit=function(e,n){return function(e,n){var r=p.is.unit(e),o={};r?o={unit:e}:'@@unitShape'in e?'function'==typeof e['@@unitShape']?o=e['@@unitShape']():b('expect @@unitShape to be a function'):o=e;var u=Array.isArray(o),a=m.useRef({stale:1,justSubscribed:0,scope:n}),i=m.useMemo((function(){a.current.stale=1;var e=Array.isArray(o)?[]:{},t=[],r=[];for(var u in o){var i=o[u];p.is.unit(i)||b('expect useUnit argument to be a unit'),p.is.event(i)||p.is.effect(i)?e[u]=n?p.scopeBind(i,{scope:n}):i:(e[u]=null,t.push(u),r.push(i))}return[e,t,r]}),[a,n].concat(Object.keys(o),Object.values(o))),c=i[0],s=i[1],f=i[2],l=m.useRef({value:c,storeKeys:s}),v=m.useCallback((function(e){var r=a.current;r.justSubscribed=1;var o=function(){r.stale||(r.stale=1,e())},u=p.step.compute({priority:'sampler',batch:1}),i=f.map((function(e){return t(e,o,n,u)}));return function(){i.forEach((function(e){return e()}))}}),[f,n,l,a]),y=m.useCallback((function(){var e,t=l.current,o=a.current,i=0,v=t.value,p=t.storeKeys,d=n!==o.scope;if((s.length>0||p.length>0)&&(o.stale||o.justSubscribed||d)){i=!o.justSubscribed||d,e=u?[].concat(c):Object.assign({},c),p.length!==s.length&&(i=1);for(var y=0;y<s.length;y++){var m=h(f[y],n),b=s[y];i||(i=p.includes(b)?v[b]!==m:1),e[b]=m}}return i&&(t.value=e),t.storeKeys=s,o.stale=0,o.justSubscribed=!i,o.scope=n,r?t.value.unit:t.value}),[v,f,n,l,a]);return d.useSyncExternalStore(v,y,y)}(e,u(null==n?void 0:n.forceScope))};
//# sourceMappingURL=compat.js.map
